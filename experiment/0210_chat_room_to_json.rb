#!/usr/bin/env ruby
require File.expand_path('../../config/environment', __FILE__)

# user = ChatUser.create!
# chat_room = user.owner_rooms.create!

# ChatRoom.latest_list.to_json(ChatRoom.to_json_params) # => 

chat_room = ChatRoom.last
tp JSON.load(chat_room.to_json(ChatRoom.to_json_params)) # => {"id"=>16, "room_owner_id"=>1, "preset_key"=>"平手", "lifetime_key"=>"lifetime5_min", "name"=>"野良1号の対戦部屋 #16", "kifu_body_sfen"=>"position startpos moves 7g7f 3c3d 2g2f", "clock_counts"=>{"black"=>[8, 3], "white"=>[2]}, "turn_max"=>3, "battle_request_at"=>"2018-05-14T21:24:35.000+09:00", "auto_matched_at"=>nil, "begin_at"=>"2018-05-14T21:24:37.000+09:00", "end_at"=>"2018-05-14T21:29:47.000+09:00", "last_action_key"=>"TIME_UP", "win_location_key"=>"black", "current_chat_users_count"=>0, "watch_memberships_count"=>0, "created_at"=>"2018-05-14T21:24:35.000+09:00", "updated_at"=>"2018-05-14T21:29:47.000+09:00", "show_path"=>"/online/battles/16", "room_owner"=>{"id"=>1, "name"=>"野良1号", "current_chat_room_id"=>nil, "online_at"=>"2018-05-15T20:36:06.000+09:00", "fighting_now_at"=>nil, "matching_at"=>nil, "lifetime_key"=>"lifetime5_min", "ps_preset_key"=>"平手", "po_preset_key"=>"平手", "created_at"=>"2018-05-13T19:22:45.000+09:00", "updated_at"=>"2018-05-15T20:36:06.000+09:00"}, "chat_users"=>[{"id"=>1, "name"=>"野良1号", "current_chat_room_id"=>nil, "online_at"=>"2018-05-15T20:36:06.000+09:00", "fighting_now_at"=>nil, "matching_at"=>nil, "lifetime_key"=>"lifetime5_min", "ps_preset_key"=>"平手", "po_preset_key"=>"平手", "created_at"=>"2018-05-13T19:22:45.000+09:00", "updated_at"=>"2018-05-15T20:36:06.000+09:00"}, {"id"=>1, "name"=>"野良1号", "current_chat_room_id"=>nil, "online_at"=>"2018-05-15T20:36:06.000+09:00", "fighting_now_at"=>nil, "matching_at"=>nil, "lifetime_key"=>"lifetime5_min", "ps_preset_key"=>"平手", "po_preset_key"=>"平手", "created_at"=>"2018-05-13T19:22:45.000+09:00", "updated_at"=>"2018-05-15T20:36:06.000+09:00"}], "watch_users"=>[], "chat_memberships"=>[{"id"=>3, "chat_room_id"=>16, "chat_user_id"=>1, "preset_key"=>"平手", "location_key"=>"black", "position"=>0, "standby_at"=>"2018-05-14T21:24:37.000+09:00", "fighting_now_at"=>nil, "created_at"=>"2018-05-14T21:24:36.000+09:00", "updated_at"=>"2018-05-15T13:58:49.000+09:00", "chat_user"=>{"id"=>1, "name"=>"野良1号", "current_chat_room_id"=>nil, "online_at"=>"2018-05-15T20:36:06.000+09:00", "fighting_now_at"=>nil, "matching_at"=>nil, "lifetime_key"=>"lifetime5_min", "ps_preset_key"=>"平手", "po_preset_key"=>"平手", "created_at"=>"2018-05-13T19:22:45.000+09:00", "updated_at"=>"2018-05-15T20:36:06.000+09:00"}}, {"id"=>4, "chat_room_id"=>16, "chat_user_id"=>1, "preset_key"=>"平手", "location_key"=>"white", "position"=>1, "standby_at"=>"2018-05-14T21:24:37.000+09:00", "fighting_now_at"=>nil, "created_at"=>"2018-05-14T21:24:36.000+09:00", "updated_at"=>"2018-05-15T13:58:49.000+09:00", "chat_user"=>{"id"=>1, "name"=>"野良1号", "current_chat_room_id"=>nil, "online_at"=>"2018-05-15T20:36:06.000+09:00", "fighting_now_at"=>nil, "matching_at"=>nil, "lifetime_key"=>"lifetime5_min", "ps_preset_key"=>"平手", "po_preset_key"=>"平手", "created_at"=>"2018-05-13T19:22:45.000+09:00", "updated_at"=>"2018-05-15T20:36:06.000+09:00"}}]}


# >> |--------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
# >> |                       id | 16                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
# >> |            room_owner_id | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
# >> |               preset_key | 平手                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
# >> |             lifetime_key | lifetime5_min                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
# >> |                     name | 野良1号の対戦部屋 #16                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
# >> |           kifu_body_sfen | position startpos moves 7g7f 3c3d 2g2f                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
# >> |             clock_counts | {"black"=>[8, 3], "white"=>[2]}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
# >> |                 turn_max | 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
# >> |        battle_request_at | 2018-05-14T21:24:35.000+09:00                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
# >> |          auto_matched_at |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
# >> |          begin_at | 2018-05-14T21:24:37.000+09:00                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
# >> |            end_at | 2018-05-14T21:29:47.000+09:00                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
# >> |          last_action_key | TIME_UP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
# >> |         win_location_key | black                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
# >> | current_chat_users_count | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
# >> |  watch_memberships_count | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
# >> |               created_at | 2018-05-14T21:24:35.000+09:00                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
# >> |               updated_at | 2018-05-14T21:29:47.000+09:00                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
# >> |                show_path | /online/battles/16                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
# >> |               room_owner | {"id"=>1, "name"=>"野良1号", "current_chat_room_id"=>nil, "online_at"=>"2018-05-15T20:36:06.000+09:00", "fighting_now_at"=>nil, "matching_at"=>nil, "lifetime_key"=>"lifetime5_min", "ps_preset_key"=>"平手", "po_preset_key"=>"平手", "created_at"=>"2018-05-13T19:22:45.000+09:00", "updated_at"=>"2018-05-15T20:36:06.000+09:00"}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
# >> |               chat_users | [{"id"=>1, "name"=>"野良1号", "current_chat_room_id"=>nil, "online_at"=>"2018-05-15T20:36:06.000+09:00", "fighting_now_at"=>nil, "matching_at"=>nil, "lifetime_key"=>"lifetime5_min", "ps_preset_key"=>"平手", "po_preset_key"=>"平手", "created_at"=>"2018-05-13T19:22:45.000+09:00", "updated_at"=>"2018-05-15T20:36:06.000+09:00"}, {"id"=>1, "name"=>"野良1号", "current_chat_room_id"=>nil, "online_at"=>"2018-05-15T20:36:06.000+09:00", "fighting_now_at"=>nil, "matching_at"=>nil, "lifetime_key"=>"lifetime5_min", "ps_preset_key"=>"平手", "po_preset_key"=>"平手", "created_at"=>"2018-05-13T19:22:45.000+09:00", "updated_at"=>"2018-05-15T20:36:06.000+09:00"}]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
# >> |              watch_users | []                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
# >> |         chat_memberships | [{"id"=>3, "chat_room_id"=>16, "chat_user_id"=>1, "preset_key"=>"平手", "location_key"=>"black", "position"=>0, "standby_at"=>"2018-05-14T21:24:37.000+09:00", "fighting_now_at"=>nil, "created_at"=>"2018-05-14T21:24:36.000+09:00", "updated_at"=>"2018-05-15T13:58:49.000+09:00", "chat_user"=>{"id"=>1, "name"=>"野良1号", "current_chat_room_id"=>nil, "online_at"=>"2018-05-15T20:36:06.000+09:00", "fighting_now_at"=>nil, "matching_at"=>nil, "lifetime_key"=>"lifetime5_min", "ps_preset_key"=>"平手", "po_preset_key"=>"平手", "created_at"=>"2018-05-13T19:22:45.000+09:00", "updated_at"=>"2018-05-15T20:36:06.000+09:00"}}, {"id"=>4, "chat_room_id"=>16, "chat_user_id"=>1, "preset_key"=>"平手", "location_key"=>"white", "position"=>1, "standby_at"=>"2018-05-14T21:24:37.000+09:00", "fighting_now_at"=>nil, "created_at"=>"2018-05-14T21:24:36.000+09:00", "updated_at"=>"2018-05-15T13:58:49.000+09:00", "chat_user"=>{"id"=>1, "name"=>"野良1号", "current_chat_room_id"=>nil, "online_at"=>"2018-05-15T20:36:06.000+09:00", "fighting_now_at"=>nil, "matching_at"=>nil, "lifetime_key"=>"lifetime5_min", "ps_preset_key"=>"平手", "po_preset_key"=>"平手", "created_at"=>"2018-05-13T19:22:45.000+09:00", "updated_at"=>"2018-05-15T20:36:06.000+09:00"}}] |
# >> |--------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
