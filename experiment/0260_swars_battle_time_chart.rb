#!/usr/bin/env ruby
require File.expand_path('../../config/environment', __FILE__)

Swars::Battle.destroy_all
Swars::User.destroy_all

user1 = Swars::User.create!(:key => "devuser1")
user2 = Swars::User.create!(:key => "devuser2")

record = Swars::Battle.new
record.final_key = :TORYO
record.csa_seq = [["-7162GI", 590],  ["+2726FU", 500],  ["-4132KI", 570]]
record.memberships.build(user: user1, judge_key: :win,  location_key: :black)
record.memberships.build(user: user2, judge_key: :lose, location_key: :white)
record.save!

record.memberships[1].leave_alone_seconds # => nil

record.memberships[0].think_max # => 20
record.memberships[1].think_max # => 100

record.memberships[0].time_chart_xy_hash_list # => [{:x=>1, :y=>10 seconds}, {:x=>3, :y=>20 seconds}]
record.memberships[1].time_chart_xy_hash_list # => [{:x=>2, :y=>-100 seconds}]
record.time_chart_label_max                   # => 3


record = Swars::Battle.new
record.final_key = :TIMEOUT
record.csa_seq = [["-7162GI", 590],  ["+2726FU", 500],  ["-4132KI", 570]]
record.memberships.build(user: user1, judge_key: :win,  location_key: :black)
record.memberships.build(user: user2, judge_key: :lose, location_key: :white)
record.save!

record.memberships[1].leave_alone_seconds # => 10 minutes and -100 seconds

record.memberships[0].think_max # => 20
record.memberships[1].think_max # => 500

record.memberships[0].time_chart_xy_hash_list # => [{:x=>1, :y=>10 seconds}, {:x=>3, :y=>20 seconds}]
record.memberships[1].time_chart_xy_hash_list # => [{:x=>2, :y=>-100 seconds}, {:x=>4, :y=>-10 minutes and 100 seconds}]
record.time_chart_label_max                   # => 4

record = Swars::Battle.last
record.time_chart_sec_list_of(Bioshogi::Location[:black]) # => [10 seconds, 20 seconds]

tp Swars::User
tp Swars::Battle
# >> |-----+----------+----------+-------------------+-------------------+---------------------------+---------------------------|
# >> | id  | user_key | grade_id | last_reception_at | search_logs_count | created_at                | updated_at                |
# >> |-----+----------+----------+-------------------+-------------------+---------------------------+---------------------------|
# >> | 152 | devuser1 |       40 |                   |                 0 | 2020-03-14 09:42:50 +0900 | 2020-03-14 09:42:50 +0900 |
# >> | 153 | devuser2 |       40 |                   |                 0 | 2020-03-14 09:42:50 +0900 | 2020-03-14 09:42:50 +0900 |
# >> |-----+----------+----------+-------------------+-------------------+---------------------------+---------------------------|
# >> |-----+----------------------------------+---------------------------+----------+--------------------------------------------------------+-----------+-------------+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------+---------------+---------------------------+---------------------------+------------+------------+---------------+------------+----------------------------------------+------------+----------------------------------+------------------+-----------------+--------------------+---------------+----------------+--------------------|
# >> | id  | key                              | battled_at                | rule_key | csa_seq                                                | final_key | win_user_id | turn_max | meta_info                                                                                                                                                                                                                                                                                                                     | accessed_at               | outbreak_turn | created_at                | updated_at                | preset_key | start_turn | critical_turn | saturn_key | sfen_body                              | image_turn | sfen_hash                        | defense_tag_list | attack_tag_list | technique_tag_list | note_tag_list | other_tag_list | kifu_body_for_test |
# >> |-----+----------------------------------+---------------------------+----------+--------------------------------------------------------+-----------+-------------+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------+---------------+---------------------------+---------------------------+------------+------------+---------------+------------+----------------------------------------+------------+----------------------------------+------------------+-----------------+--------------------+---------------+----------------+--------------------|
# >> | 159 | ca0efe38530601977b5e6acc5f60eb86 | 2020-03-14 09:42:50 +0900 | ten_min  | [["-7162GI", 590], ["+2726FU", 500], ["-4132KI", 570]] | TORYO     |         152 |        3 | {:header=>{"先手"=>"devuser1 30級", "後手"=>"devuser2 30級", "開始日時"=>"2020/03/14 09:42:50", "棋戦"=>"将棋ウォーズ(10分切れ負け)", "場所"=>"https://shogiwars.heroz.jp/games/ca0efe38530601977b5e6acc5f60eb86", "持ち時間"=>"00:10+00", "先手の備考"=>"居飛車, 相居飛車, 居玉, 相居玉", "後手の備考"=>"居飛車, 相居飛車... | 2020-03-14 09:42:50 +0900 |               | 2020-03-14 09:42:50 +0900 | 2020-03-14 09:42:50 +0900 | 平手       |            |               | public     | position startpos moves 7a6b 2g2f 4a3b |            | 4811179a63c27d2edd87109e10c7a065 |                  |                 |                    |               |                |                    |
# >> | 160 | 86ddb9132e03a41e909dfb8396c4ee47 | 2020-03-14 09:42:50 +0900 | ten_min  | [["-7162GI", 590], ["+2726FU", 500], ["-4132KI", 570]] | TIMEOUT   |         152 |        3 | {:header=>{"先手"=>"devuser1 30級", "後手"=>"devuser2 30級", "開始日時"=>"2020/03/14 09:42:50", "棋戦"=>"将棋ウォーズ(10分切れ負け)", "場所"=>"https://shogiwars.heroz.jp/games/86ddb9132e03a41e909dfb8396c4ee47", "持ち時間"=>"00:10+00", "先手の備考"=>"居飛車, 相居飛車, 居玉, 相居玉", "後手の備考"=>"居飛車, 相居飛車... | 2020-03-14 09:42:50 +0900 |               | 2020-03-14 09:42:50 +0900 | 2020-03-14 09:42:50 +0900 | 平手       |            |               | public     | position startpos moves 7a6b 2g2f 4a3b |            | 4811179a63c27d2edd87109e10c7a065 |                  |                 |                    |               |                |                    |
# >> |-----+----------------------------------+---------------------------+----------+--------------------------------------------------------+-----------+-------------+----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------+---------------+---------------------------+---------------------------+------------+------------+---------------+------------+----------------------------------------+------------+----------------------------------+------------------+-----------------+--------------------+---------------+----------------+--------------------|
