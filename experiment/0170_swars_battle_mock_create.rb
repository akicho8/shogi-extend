#!/usr/bin/env ruby
require File.expand_path('../../config/environment', __FILE__)

user1 = Swars::User.create!
user2 = Swars::User.create!

# cycle = ["▲58玉", "△52玉", "▲59玉", "△51玉"].cycle
cycle = [["+5958OU", 599],  ["-5152OU", 597],  ["+5859OU", 598],  ["-5251OU", 590]].cycle

battle = Swars::Battle.new
battle.csa_seq = 151.times.collect { cycle.next }
battle.memberships.build(user: user1, judge_key: :win,  location_key: :black)
battle.memberships.build(user: user2, judge_key: :lose, location_key: :white)
battle.battled_at = Time.current
battle.save!                  # => true

tp Swars::Battle.last

# >> |--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
# >> |                 id | 64                                                                                                                                                                                                                                                                                                  |
# >> |                key | 742216c63fd5b5bed7b962e440ad8c6b                                                                                                                                                                                                                                                                    |
# >> |         battled_at | 2019-06-29 13:38:51 +0900                                                                                                                                                                                                                                                                           |
# >> |           rule_key | ten_min                                                                                                                                                                                                                                                                                             |
# >> |            csa_seq | [["+5958OU", 599], ["-5152OU", 597], ["+5859OU", 598], ["-5251OU", 590], ["+5958OU", 599], ["-5152OU", 597], ["+5859OU", 598], ["-5251OU", 590], ["+5958OU", 599], ["-5152OU", 597], ["+5859OU", 598], ["-5251OU", 590], ["+5958OU", 599], ["-5152OU", 597], ["+...                                 |
# >> |          final_key | TORYO                                                                                                                                                                                                                                                                                               |
# >> |        win_user_id | 61                                                                                                                                                                                                                                                                                                  |
# >> |           turn_max | 151                                                                                                                                                                                                                                                                                                 |
# >> |          meta_info | {:header=>{"先手"=>"b6a69c3bc78693b0e777e9d536404c29 30級", "後手"=>"32a98c64bd316eb1d22a76370311c6d0 30級", "開始日時"=>"2019/06/29 13:38:51", "棋戦"=>"将棋ウォーズ(10分切れ負け)", "場所"=>"http://kif-pona.heroz.jp/games/742216c63fd5b5bed7b962e440ad8c6b", "持ち時間"=>"00:10+00", "先手の... |
# >> |    last_accessd_at | 2019-06-29 13:38:51 +0900                                                                                                                                                                                                                                                                           |
# >> |  access_logs_count | 0                                                                                                                                                                                                                                                                                                   |
# >> |         created_at | 2019-06-29 13:38:51 +0900                                                                                                                                                                                                                                                                           |
# >> |         updated_at | 2019-06-29 13:38:51 +0900                                                                                                                                                                                                                                                                           |
# >> |         preset_key | 平手                                                                                                                                                                                                                                                                                                |
# >> |         start_turn |                                                                                                                                                                                                                                                                                                     |
# >> |      critical_turn |                                                                                                                                                                                                                                                                                                     |
# >> |         saturn_key | public                                                                                                                                                                                                                                                                                              |
# >> |          sfen_body | position startpos moves 5i5h 5a5b 5h5i 5b5a 5i5h 5a5b 5h5i 5b5a 5i5h 5a5b 5h5i 5b5a 5i5h 5a5b 5h5i 5b5a 5i5h 5a5b 5h5i 5b5a 5i5h 5a5b 5h5i 5b5a 5i5h 5a5b 5h5i 5b5a 5i5h 5a5b 5h5i 5b5a 5i5h 5a5b 5h5i 5b5a 5i5h 5a5b 5h5i 5b5a 5i5h 5a5b 5h5i 5b5a 5i5h 5a5b 5h...                                 |
# >> |         image_turn |                                                                                                                                                                                                                                                                                                     |
# >> |   defense_tag_list |                                                                                                                                                                                                                                                                                                     |
# >> |    attack_tag_list |                                                                                                                                                                                                                                                                                                     |
# >> | technique_tag_list |                                                                                                                                                                                                                                                                                                     |
# >> |      note_tag_list |                                                                                                                                                                                                                                                                                                     |
# >> |     other_tag_list |                                                                                                                                                                                                                                                                                                     |
# >> |    secret_tag_list |                                                                                                                                                                                                                                                                                                     |
# >> | kifu_body_for_test |                                                                                                                                                                                                                                                                                                     |
# >> |--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
