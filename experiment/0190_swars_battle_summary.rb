#!/usr/bin/env ruby
require File.expand_path('../../config/environment', __FILE__)

module Swars
  user1 = User.create!
  user2 = User.create!

  battle = Battle.new
  # battle.csa_seq = [["-7162GI", 599],  ["+2726FU", 597],  ["-4132KI", 598],  ["+6978KI", 590],  ["-5354FU", 596],  ["+3948GI", 588],  ["-6253GI", 595],  ["+9796FU", 582],  ["-9394FU", 594],  ["+7776FU", 568],  ["-4344FU", 592],  ["+7968GI", 563],  ["-5162OU", 589],  ["+6877GI", 552],  ["-6172KI", 587],  ["+6766FU", 550],  ["-7374FU", 582],  ["+4958KI", 548],  ["-3142GI", 573],  ["+5867KI", 541],  ["-5455FU", 572],  ["+4746FU", 538],  ["-4243GI", 566],  ["+4847GI", 536],  ["-4354GI", 552],  ["+3736FU", 517],  ["-3334FU", 544],  ["+2625FU", 504],  ["-3233KI", 543],  ["+2937KE", 489],  ["-1314FU", 536],  ["+1716FU", 479],  ["-7273KI", 525],  ["+4645FU", 462],  ["-3435FU", 504],  ["+5756FU", 430],  ["-5556FU", 490],  ["+6756KI", 426],  ["-3536FU", 475],  ["+4736GI", 421],  ["-0035FU", 473],  ["+3647GI", 413],  ["-0055FU", 467],  ["+5646KI", 400],  ["-3334KI", 465],  ["+2524FU", 385],  ["-4445FU", 445],  ["+3745KE", 379],  ["-5445GI", 442],  ["+2423TO", 369],  ["-4546GI", 419],  ["+4746GI", 365],  ["-0025FU", 410],  ["+0044FU", 323],  ["-0047KI", 368],  ["+4443TO", 147],  ["-5364GI", 350],  ["+8879KA", 146],  ["-0036KE", 346],  ["+2818HI", 145],  ["-5556FU", 345],  ["+4635GI", 144],  ["-5657TO", 341],  ["+0049FU", 143],  ["-3435KI", 337],  ["+6665FU", 142],  ["-0058GI", 334]]
  # battle.csa_seq = [["-7162GI", 599],  ["+2726FU", 597],  ["-4132KI", 598],  ["+6978KI", 590],]

  # 最後に指す
  # battle.csa_seq = [["+7968GI", 180], ["-8384FU", 180], ["+5756FU", 180], ["-8485FU", 180], ["+6857GI", 179], ["-3334FU", 180], ["+6978KI", 179], ["-7162GI", 179], ["+2726FU", 178], ["-4132KI", 179], ["+2625FU", 177], ["-2233KA", 179], ["+8879KA", 177], ["-3122GI", 179], ["+3948GI", 175], ["-4344FU", 178], ["+3736FU", 175], ["-6152KI", 177], ["+3635FU", 174], ["-5243KI", 177], ["+3534FU", 173], ["-4334KI", 177], ["+5746GI", 171], ["-4445FU", 176], ["+4635GI", 171], ["-3435KI", 175], ["+7935KA", 170], ["-0034FU", 175], ["+3579KA", 169], ["-8586FU", 175], ["+8786FU",168], ["-8286HI", 174], ["+0087FU", 167], ["-8656HI", 173], ["+5969OU", 166], ["-9394FU", 172], ["+2524FU", 160], ["-2324FU", 171], ["+7924KA", 159], ["-3324KA", 165], ["+2824HI", 158], ["-0057GI", 160], ["+0065KA", 153], ["-5654HI", 144], ["+6554KA", 151], ["-5354FU", 144], ["+4857GI", 149], ["-0035KA", 143], ["+2422RY", 145], ["-3222KI", 142], ["+0043GI", 144], ["-5161OU", 135], ["+0082HI", 135], ["-3557KA", 126], ["+0052GI", 132], ["-6171OU", 1], ["+0072KI", 129]]
  # battle.rule_key = :three_min

  # 放置
  battle.csa_seq = [["+7776FU", 600], ["-3334FU", 600], ["+6978KI", 599], ["-4344FU", 597], ["+2726FU", 597], ["-3132GI", 595], ["+3948GI", 596], ["-3243GI", 594], ["+5756FU", 596], ["-2233KA", 593], ["+4857GI", 595], ["-8222HI", 591], ["+7968GI", 593], ["-5162OU", 590], ["+5969OU", 592], ["-7172GI", 589], ["+6979OU", 591], ["-6271OU", 588], ["+8866KA", 590], ["-9394FU", 586], ["+7988OU", 590], ["-7182OU", 585], ["+9998KY", 589], ["-4132KI", 583], ["+8899OU", 588], ["-2324FU", 579], ["+6877GI", 585], ["-4445FU", 577], ["+7788GI", 580], ["-3366KA", 567], ["+5766GI",574], ["-2133KE", 565], ["+6657GI", 568], ["-2425FU", 563], ["+2625FU", 567], ["-2225HI", 562], ["+0026FU", 561], ["-2521HI", 558], ["+7879KI", 559], ["-0044KA", 553], ["+4958KI", 550], ["-2126HI", 551], ["+2826HI", 545], ["-4426KA", 549], ["+0021HI", 537], ["-0028HI", 547], ["+5868KI", 533], ["-2829RY", 539], ["+2111RY", 531], ["-2637UM", 538], ["+0021KA", 513], ["-3719UM", 524], ["+0055KY", 482], ["-0051KY", 520], ["+2132UM", 476], ["-4332GI", 518], ["+0042KI", 471], ["-3221GI", 513], ["+1113RY", 446], ["-0012FU", 509], ["+1333RY", 444], ["-5354FU", 503], ["+4251KI", 434], ["-6151KI", 502], ["+5554KY", 433], ["-0042KI", 495], ["+3334RY", 417], ["-0053FU", 493], ["+5453NY", 416], ["-4253KI", 492], ["+0054KY", 415], ["-0042KE", 487], ["+3445RY", 404], ["-4254KE", 483], ["+5655FU", 400], ["-0044FU", 481], ["+4556RY", 398],["-0045KA", 452], ["+5665RY", 379], ["-5364KI", 449], ["+6585RY", 377], ["-8384FU", 446], ["+8586RY", 369], ["-6455KI", 442], ["+0075KE", 367], ["-0085KY", 420], ["+8677RY", 365], ["-0056FU", 413], ["+5746GI", 351], ["-5446KE", 412], ["+4746FU", 349], ["-5546KI", 410], ["+8786FU", 348], ["-8271OU", 395], ["+8685FU", 347], ["-8485FU", 393], ["+0086FU", 336], ["-5657TO", 391], ["+6878KI", 335], ["-4647KI", 377], ["+8685FU", 332], ["-0082FU", 375], ["+8584FU", 331], ["-1955UM", 371], ["+7786RY", 327], ["-5767TO", 368], ["+7867KI", 323], ["-4567UM", 366], ["+0085KY", 320], ["-2979RY", 359]]
  battle.rule_key = :ten_min
  battle.final_key = :TIMEOUT

  battle.memberships.build(user: user1, judge_key: :lose, location_key: :black)
  battle.memberships.build(user: user2, judge_key: :win,  location_key: :white)
  battle.save!
  tp battle

  battle.memberships.first.sec_list # => [0, 1, 2, 1, 0, 1, 2, 1, 1, 1, 0, 1, 1, 3, 5, 6, 6, 1, 6, 2, 9, 5, 8, 4, 2, 18, 31, 6, 5, 25, 2, 10, 1, 16, 1, 1, 11, 4, 2, 19, 2, 8, 2, 2, 14, 2, 1, 1, 11, 1, 3, 1, 4, 4, 3]
  battle.memberships.first.swgod_level1_used?     # => false
  battle.memberships.last.sec_list  # => [0, 3, 2, 1, 1, 2, 1, 1, 1, 2, 1, 2, 4, 2, 10, 2, 2, 1, 4, 5, 2, 2, 2, 8, 1, 14, 4, 2, 5, 4, 6, 1, 7, 2, 1, 5, 4, 2, 29, 3, 3, 4, 22, 7, 1, 2, 15, 2, 2, 14, 2, 4, 3, 2, 7]
  battle.memberships.last.swgod_level1_used?      # => false

  tp user1.basic_summary
  tp user2.basic_summary
end
# >> |-------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
# >> |                id | 75                                                                                                                                                                                                                                                                                                                                   |
# >> |               key | 2902a0b5d0f0cf230aa10f34190c9dd5                                                                                                                                                                                                                                                                                                     |
# >> |        battled_at | 2019-03-08 18:24:59 +0900                                                                                                                                                                                                                                                                                                            |
# >> |          rule_key | ten_min                                                                                                                                                                                                                                                                                                                              |
# >> |           csa_seq | [["+7776FU", 600], ["-3334FU", 600], ["+6978KI", 599], ["-4344FU", 597], ["+2726FU", 597], ["-3132GI", 595], ["+3948GI", 596], ["-3243GI", 594], ["+5756FU", 596], ["-2233KA", 593], ["+4857GI", 595], ["-8222HI", 591], ["+7968GI", 593], ["-5162OU", 590], ["+...                                                                  |
# >> |         final_key | TIMEOUT                                                                                                                                                                                                                                                                                                                              |
# >> |       win_user_id | 161                                                                                                                                                                                                                                                                                                                                  |
# >> |          turn_max | 110                                                                                                                                                                                                                                                                                                                                  |
# >> |         meta_info | {:header=>{"先手"=>"f32ff24253a3e7b3d74b2396336d359e 30級", "後手"=>"dc42f1a0c9ad745eb69741e06c0993e3 30級", "開始日時"=>"2019/03/08 18:24:59", "棋戦"=>"将棋ウォーズ(10分切れ負け)", "持ち時間"=>"00:10+00", "先手の囲い"=>"居飛車穴熊", "後手の囲い"=>"片美濃囲い", "後手の戦型"=>"向かい飛車, 鬼殺し向かい飛車"}, :detail_name... |
# >> |   last_accessd_at | 2019-03-08 18:24:59 +0900                                                                                                                                                                                                                                                                                                            |
# >> | access_logs_count | 0                                                                                                                                                                                                                                                                                                                                    |
# >> |        created_at | 2019-03-08 18:24:59 +0900                                                                                                                                                                                                                                                                                                            |
# >> |        updated_at | 2019-03-08 18:24:59 +0900                                                                                                                                                                                                                                                                                                            |
# >> |        preset_key | 平手                                                                                                                                                                                                                                                                                                                                 |
# >> |  defense_tag_list |                                                                                                                                                                                                                                                                                                                                      |
# >> |   attack_tag_list |                                                                                                                                                                                                                                                                                                                                      |
# >> |    other_tag_list |                                                                                                                                                                                                                                                                                                                                      |
# >> |   secret_tag_list |                                                                                                                                                                                                                                                                                                                                      |
# >> |-------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
# >> |--------------------------------------+---------|
# >> |               取得できた直近の対局数 | 1       |
# >> |                                 勝ち | 0回     |
# >> |                                 負け | 1回     |
# >> |                             切れ負け | 1回     |
# >> |                     【10分】最大長考 | 31秒    |
# >> |               【10分】最終着手の最長 | 3秒     |
# >> | 【10分】切れ負けたときの最長残り時間 | 5分20秒 |
# >> |  【10分】2分以上考えたまま切れ負けた | 1回     |
# >> |                               投了率 | 0.0 %   |
# >> |                               切断率 | 0.0 %   |
# >> |--------------------------------------+---------|
# >> |------------------------+-------|
# >> | 取得できた直近の対局数 | 1     |
# >> |                   勝ち | 1回   |
# >> |                   負け | 0回   |
# >> |               切れ勝ち | 1回   |
# >> |       【10分】最大長考 | 29秒  |
# >> | 【10分】最終着手の最長 | 7秒   |
# >> |         棋神召喚疑惑率 | 0.0 % |
# >> |------------------------+-------|
