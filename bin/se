#!/usr/bin/env ruby
require "#{__dir__}/../config/environment"
require "thor"

class App < Thor
  desc "say -r åˆè¨€è‘‰ -n åå‰ -m ç™ºè¨€", "å…±æœ‰å°†æ£‹ç›¤ã®ãƒãƒ£ãƒƒãƒˆã§ç™ºè¨€ã™ã‚‹"
  method_option :room_code,      type: :string, default: "dev_room",   aliases: "-r", desc: "åˆè¨€è‘‰"
  method_option :message,        type: :string, default: "OK",         aliases: "-m", desc: "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"
  method_option :from_user_name, type: :string, default: "GPT",        aliases: "-n", desc: "åå‰"
  def say
    ShareBoard::Broadcaster.new(options[:room_code]).call("message_share_broadcasted", {
        :message        => options[:message],
        :from_user_name => options[:from_user_name],
        :primary_emoji  => "ğŸ¤–",
      })
  end

  desc "gpt -r åˆè¨€è‘‰", "å…±æœ‰å°†æ£‹ç›¤ã«ã„ã‚‹GPTã«å¯¾ã—ã¦ç™ºè¨€ã‚’ä¿ƒã™"
  method_option :room_code, type: :string, default: "dev_room", aliases: "-r", desc: "åˆè¨€è‘‰"
  method_option :message,   type: :string, default: nil,        aliases: "-m", desc: "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"
  def gpt
    ShareBoard::Responder2.new(room_code: options[:room_code], message: options[:message]).call
  end

  desc "about", "æƒ…å ±"
  def about
    p Rails.env
  end

  start
end
