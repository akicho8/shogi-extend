<template lang="pug">
.modal-card
  .modal-card-head
    .modal-card-title
      | 手合割
    div
      span.mx-1 評価値
      span(v-if="base.board_preset_info.handicap_level >= 1") +
      | {{base.board_preset_info.handicap_level}}
  .modal-card-body
    .select_container
      b-select.board_preset_key(v-model="base.board_preset_key" @input="$sound.play_click()")
        option(v-for="e in base.BoardPresetInfo.values" :value="e.key" v-text="e.name")
    .sp_container.mt-4
      CustomShogiPlayer(
        sp_mode="view"
        :sp_mobile_vertical="false"
        sp_layout="horizontal"
        sp_piece_variant="b"
        :sp_piece_stand_blank_then_hidden="false"
        sp_operation_disabled
        :sp_turn="0"
        :sp_body="base.board_preset_info.sfen"
      )
    .description_container.mt-4
      .description
        | {{base.board_preset_info.description}}
    .buttons_container.buttons.has-addons.is-centered.mb-0.mt-4
      b-button.mb-0(@click="next_handle(-1)" icon-left="chevron-left")
      b-button.mb-0(@click="next_handle(1)" icon-left="chevron-right")
  .modal-card-foot
    b-button.close_handle.has-text-weight-normal(@click="close_handle" icon-left="chevron-left") 閉じる
    b-button.apply_button(@click="apply_handle" type="is-primary") 適用
</template>

<script>
import { support_child } from "./support_child.js"

export default {
  name: "BoardPresetSelectModal",
  mixins: [support_child],
  methods: {
    next_handle(v) {
      this.$sound.play_click()
      const i = this.base.board_preset_info.code + v
      const new_index = this.imodulo(i, this.base.BoardPresetInfo.values.length)
      const next = this.base.BoardPresetInfo.fetch(new_index)
      this.base.board_preset_key = next.key
    },
    close_handle() {
      this.$sound.play_click()
      this.$emit("close")
    },
    apply_handle() {
      this.$sound.play_click()
      this.base.force_sync_handicap()
      this.$emit("close")
    },
  },
}
</script>

<style lang="sass">
@import "support.sass"
.BoardPresetSelectModal
  +modal_width(32rem)
  .modal-card-body
    padding: 1.25rem
    .select_container
      display: flex
      justify-content: center
    .sp_container
      display: flex
      justify-content: center
    .description_container
      display: flex
      justify-content: center
    .buttons_container
      .button
        min-width: 8rem

  .CustomShogiPlayer
    width: 16rem
    --sp_board_padding: 0
    --sp_board_color: transparent
    --sp_grid_outer_stroke: 0
    --sp_grid_outer_color: hsl(0, 0%, 80%)
    --sp_grid_inner_color:       hsl(0, 0%, 80%)

.STAGE-development
  .BoardPresetSelectModal
    .sp_container
      border: 1px dashed change_color($primary, $alpha: 0.5)
    .modal-card-body
      border: 1px dashed change_color($info, $alpha: 0.5)
</style>
