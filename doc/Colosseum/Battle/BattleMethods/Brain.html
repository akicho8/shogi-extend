<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Colosseum::Battle::BattleMethods::Brain
  
    &mdash; Documentation by YARD 0.9.20
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Colosseum::Battle::BattleMethods::Brain";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (B)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Colosseum.html" title="Colosseum (module)">Colosseum</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Battle.html" title="Colosseum::Battle (class)">Battle</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../BattleMethods.html" title="Colosseum::Battle::BattleMethods (module)">BattleMethods</a></span></span>
     &raquo; 
    <span class="title">Brain</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Colosseum::Battle::BattleMethods::Brain
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Colosseum::Battle::BattleMethods::Brain</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/models/colosseum/battle/battle_methods.rb</dd>
  </dl>
  
</div>





  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#battle-instance_method" title="#battle (instance method)">#<strong>battle</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute battle.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#mediator-instance_method" title="#mediator (instance method)">#<strong>mediator</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute mediator.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#__trace-instance_method" title="#__trace (instance method)">#<strong>__trace</strong>(message)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clock_counts_update-instance_method" title="#clock_counts_update (instance method)">#<strong>clock_counts_update</strong>(clock_counter)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>時間が元に戻る不具合に対応するための案 1.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute_loop_if_robot-instance_method" title="#execute_loop_if_robot (instance method)">#<strong>execute_loop_if_robot</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute_one-instance_method" title="#execute_one (instance method)">#<strong>execute_one</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(battle, mediator)  &#x21d2; Brain </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of Brain.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#measure_time-instance_method" title="#measure_time (instance method)">#<strong>measure_time</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mediator_broadcast-instance_method" title="#mediator_broadcast (instance method)">#<strong>mediator_broadcast</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#tactic_notify-instance_method" title="#tactic_notify (instance method)">#<strong>tactic_notify</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>戦法を自動発言.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate_checkmate_ignore-instance_method" title="#validate_checkmate_ignore (instance method)">#<strong>validate_checkmate_ignore</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>現局面で王手放置していたら指した人の負け.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#win_check-instance_method" title="#win_check (instance method)">#<strong>win_check</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>次の手番の合法手がない = 詰ました = 勝ち.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(battle, mediator)  &#x21d2; <tt><span class='object_link'><a href="" title="Colosseum::Battle::BattleMethods::Brain (class)">Brain</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of Brain</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


46
47
48
49</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/colosseum/battle/battle_methods.rb', line 46</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_battle'>battle</span><span class='comma'>,</span> <span class='id identifier rubyid_mediator'>mediator</span><span class='rparen'>)</span>
  <span class='ivar'>@battle</span> <span class='op'>=</span> <span class='id identifier rubyid_battle'>battle</span>
  <span class='ivar'>@mediator</span> <span class='op'>=</span> <span class='id identifier rubyid_mediator'>mediator</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="battle-instance_method">
  
    #<strong>battle</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute battle</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


41
42
43</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/colosseum/battle/battle_methods.rb', line 41</span>

<span class='kw'>def</span> <span class='id identifier rubyid_battle'>battle</span>
  <span class='ivar'>@battle</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="mediator-instance_method">
  
    #<strong>mediator</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute mediator</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


41
42
43</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/colosseum/battle/battle_methods.rb', line 41</span>

<span class='kw'>def</span> <span class='id identifier rubyid_mediator'>mediator</span>
  <span class='ivar'>@mediator</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="__trace-instance_method">
  
    #<strong>__trace</strong>(message)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


208
209
210
211</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/colosseum/battle/battle_methods.rb', line 208</span>

<span class='kw'>def</span> <span class='id identifier rubyid___trace'>__trace</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_env'>env</span><span class='period'>.</span><span class='id identifier rubyid_production?'>production?</span>
  <span class='id identifier rubyid_active_user'>active_user</span><span class='period'>.</span><span class='id identifier rubyid_chat_say'>chat_say</span><span class='lparen'>(</span><span class='id identifier rubyid_battle'>battle</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='label'>msg_class:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>has-text-danger</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="clock_counts_update-instance_method">
  
    #<strong>clock_counts_update</strong>(clock_counter)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>時間が元に戻る不具合に対応するための案</p>
<ol><li>
<p>battle_channel.rb で battle をメモ化しない</p>
</li><li>
<p>clock_counts_update のところで reload する</p>
</li><li>
<p>clock_counts をまるごと送る</p>
</li></ol>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


173
174
175
176
177
178
179
180
181
182
183
184
185
186</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/colosseum/battle/battle_methods.rb', line 173</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clock_counts_update'>clock_counts_update</span><span class='lparen'>(</span><span class='id identifier rubyid_clock_counter'>clock_counter</span><span class='rparen'>)</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_tagged'>tagged</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>clock_counts_update</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='kw'>if</span> <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_env'>env</span><span class='period'>.</span><span class='id identifier rubyid_development?'>development?</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_battle'>battle</span><span class='period'>.</span><span class='id identifier rubyid_turn_max'>turn_max</span> <span class='op'>&gt;=</span> <span class='int'>2</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_battle'>battle</span><span class='period'>.</span><span class='id identifier rubyid_clock_counts'>clock_counts</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span> <span class='rbrace'>}</span>
          <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2手進んでいるにもかかわらずチェスクロックの片方の手番の情報が入っていない : </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_battle'>battle</span><span class='period'>.</span><span class='id identifier rubyid_clock_counts'>clock_counts</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
      <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_mediator'>mediator</span><span class='period'>.</span><span class='id identifier rubyid_opponent_player'>opponent_player</span><span class='period'>.</span><span class='id identifier rubyid_location'>location</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_clock_counter'>clock_counter</span><span class='comma'>,</span> <span class='id identifier rubyid_battle'>battle</span><span class='period'>.</span><span class='id identifier rubyid_clock_counts'>clock_counts</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_battle'>battle</span><span class='period'>.</span><span class='id identifier rubyid_clock_counts'>clock_counts</span><span class='lbracket'>[</span><span class='id identifier rubyid_mediator'>mediator</span><span class='period'>.</span><span class='id identifier rubyid_opponent_player'>opponent_player</span><span class='period'>.</span><span class='id identifier rubyid_location'>location</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_clock_counter'>clock_counter</span><span class='rparen'>)</span> <span class='comment'># push でも AR は INSERT 対象になる
</span>  <span class='id identifier rubyid_battle'>battle</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute_loop_if_robot-instance_method">
  
    #<strong>execute_loop_if_robot</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


74
75
76
77
78
79
80
81</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/colosseum/battle/battle_methods.rb', line 74</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute_loop_if_robot'>execute_loop_if_robot</span>
  <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_active_user'>active_user</span><span class='period'>.</span><span class='id identifier rubyid_race_info'>race_info</span><span class='period'>.</span><span class='id identifier rubyid_auto_hand'>auto_hand</span>
      <span class='kw'>break</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_execute_one'>execute_one</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute_one-instance_method">
  
    #<strong>execute_one</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/colosseum/battle/battle_methods.rb', line 83</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute_one'>execute_one</span>
  <span class='id identifier rubyid_clock_counter'>clock_counter</span> <span class='op'>=</span> <span class='id identifier rubyid_measure_time'>measure_time</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_hand'>hand</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_mediator'>mediator</span>

    <span class='comment'># 先を読む
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_cpu_brain_info'>cpu_brain_info</span><span class='period'>.</span><span class='id identifier rubyid_depth_max_range'>depth_max_range</span>
      <span class='id identifier rubyid_brain'>brain</span> <span class='op'>=</span> <span class='id identifier rubyid_mediator'>mediator</span><span class='period'>.</span><span class='id identifier rubyid_current_player'>current_player</span><span class='period'>.</span><span class='id identifier rubyid_brain'>brain</span><span class='lparen'>(</span><span class='label'>diver_class:</span> <span class='const'>Bioshogi</span><span class='op'>::</span><span class='const'>NegaScoutDiver</span><span class='comma'>,</span> <span class='label'>evaluator_class:</span> <span class='const'>Bioshogi</span><span class='op'>::</span><span class='const'>EvaluatorAdvance</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_records'>records</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

      <span class='id identifier rubyid_cpu_brain_info'>cpu_brain_info</span><span class='period'>.</span><span class='id identifier rubyid_time_limit'>time_limit</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='period'>.</span><span class='id identifier rubyid_with_index'>with_index</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_tl'>tl</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
        <span class='kw'>begin</span>
          <span class='id identifier rubyid_tp'>tp</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='label'>i:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_content'>回目</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>time_limit:</span> <span class='id identifier rubyid_tl'>tl</span><span class='rbrace'>}</span><span class='rparen'>)</span>
          <span class='id identifier rubyid___trace'>__trace</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cpu_brain_info'>cpu_brain_info</span><span class='period'>.</span><span class='id identifier rubyid_depth_max_range'>depth_max_range</span><span class='embexpr_end'>}</span><span class='tstring_content'>手先まで最大</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tl'>tl</span><span class='embexpr_end'>}</span><span class='tstring_content'>秒かけて読んでます</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='id identifier rubyid_records'>records</span> <span class='op'>=</span> <span class='id identifier rubyid_brain'>brain</span><span class='period'>.</span><span class='id identifier rubyid_iterative_deepening'>iterative_deepening</span><span class='lparen'>(</span><span class='label'>time_limit:</span> <span class='id identifier rubyid_tl'>tl</span><span class='comma'>,</span> <span class='label'>depth_max_range:</span> <span class='id identifier rubyid_cpu_brain_info'>cpu_brain_info</span><span class='period'>.</span><span class='id identifier rubyid_depth_max_range'>depth_max_range</span><span class='rparen'>)</span>
          <span class='kw'>break</span>
        <span class='kw'>rescue</span> <span class='const'>Bioshogi</span><span class='op'>::</span><span class='const'>BrainProcessingHeavy</span>
          <span class='id identifier rubyid___trace'>__trace</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>無理でした</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='kw'>unless</span> <span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_tp'>tp</span> <span class='const'>Bioshogi</span><span class='op'>::</span><span class='const'>Brain</span><span class='period'>.</span><span class='id identifier rubyid_human_format'>human_format</span><span class='lparen'>(</span><span class='id identifier rubyid_records'>records</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_record'>record</span> <span class='op'>=</span> <span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
        <span class='id identifier rubyid_tp'>tp</span> <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>
        <span class='id identifier rubyid_hand'>hand</span> <span class='op'>=</span> <span class='id identifier rubyid_record'>record</span><span class='lbracket'>[</span><span class='symbol'>:hand</span><span class='rbracket'>]</span>

        <span class='id identifier rubyid___trace'>__trace</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_record'>record</span><span class='lbracket'>[</span><span class='symbol'>:best_pv</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'>手先まで読んで</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hand'>hand</span><span class='embexpr_end'>}</span><span class='tstring_content'>を指しました。評価値:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_record'>record</span><span class='lbracket'>[</span><span class='symbol'>:score2</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> 読み筋:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_record'>record</span><span class='lbracket'>[</span><span class='symbol'>:best_pv</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_s</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># 読めなかった場合はランダムまたは合法手から選択する
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_hand'>hand</span>
      <span class='id identifier rubyid_hands'>hands</span> <span class='op'>=</span> <span class='id identifier rubyid_mediator'>mediator</span><span class='period'>.</span><span class='id identifier rubyid_current_player'>current_player</span><span class='period'>.</span><span class='id identifier rubyid_normal_all_hands'>create_all_hands</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
      <span class='id identifier rubyid_legal'>legal</span> <span class='op'>=</span> <span class='id identifier rubyid_cpu_brain_info'>cpu_brain_info</span><span class='period'>.</span><span class='id identifier rubyid_legal_only'>legal_only</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_cpu_brain_info'>cpu_brain_info</span><span class='period'>.</span><span class='id identifier rubyid_mate_danger_check'>mate_danger_check</span>
        <span class='id identifier rubyid_legal'>legal</span> <span class='op'>||=</span> <span class='id identifier rubyid_mediator'>mediator</span><span class='period'>.</span><span class='id identifier rubyid_current_player'>current_player</span><span class='period'>.</span><span class='id identifier rubyid_mate_danger?'>mate_danger?</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_legal'>legal</span>
        <span class='id identifier rubyid_hands'>hands</span> <span class='op'>=</span> <span class='id identifier rubyid_hands'>hands</span><span class='period'>.</span><span class='id identifier rubyid_find_all'>find_all</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_legal_move?'>legal_hand?</span><span class='lparen'>(</span><span class='id identifier rubyid_mediator'>mediator</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_hand'>hand</span> <span class='op'>=</span> <span class='id identifier rubyid_hands'>hands</span><span class='period'>.</span><span class='id identifier rubyid_sample'>sample</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_hand'>hand</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_legal'>legal</span>
          <span class='id identifier rubyid___trace'>__trace</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>合法手から</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hand'>hand</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid___trace'>__trace</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ランダムで</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hand'>hand</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># 手がなければ詰まされている
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_hand'>hand</span>
      <span class='id identifier rubyid_battle'>battle</span><span class='period'>.</span><span class='id identifier rubyid_game_end_exit'>game_end_exit</span><span class='lparen'>(</span><span class='label'>win_location_key:</span> <span class='id identifier rubyid_mediator'>mediator</span><span class='period'>.</span><span class='id identifier rubyid_opponent_player'>opponent_player</span><span class='period'>.</span><span class='id identifier rubyid_location'>location</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='label'>last_action_key:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TSUMI</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_mediator'>mediator</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_hand'>hand</span><span class='period'>.</span><span class='id identifier rubyid_to_sfen'>to_sfen</span><span class='comma'>,</span> <span class='label'>executor_class:</span> <span class='const'>Bioshogi</span><span class='op'>::</span><span class='const'>PlayerExecutorCpu</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_validate_checkmate_ignore'>validate_checkmate_ignore</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_tactic_notify'>tactic_notify</span>
  <span class='id identifier rubyid_clock_counts_update'>clock_counts_update</span><span class='lparen'>(</span><span class='id identifier rubyid_clock_counter'>clock_counter</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mediator_broadcast'>mediator_broadcast</span>
  <span class='id identifier rubyid_win_check'>win_check</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="measure_time-instance_method">
  
    #<strong>measure_time</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


151
152
153
154
155
156</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/colosseum/battle/battle_methods.rb', line 151</span>

<span class='kw'>def</span> <span class='id identifier rubyid_measure_time'>measure_time</span>
  <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_yield_self'>yield_self</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
    <span class='kw'>yield</span>
    <span class='lparen'>(</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span> <span class='op'>-</span> <span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_ceil'>ceil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mediator_broadcast-instance_method">
  
    #<strong>mediator_broadcast</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/colosseum/battle/battle_methods.rb', line 188</span>

<span class='kw'>def</span> <span class='id identifier rubyid_mediator_broadcast'>mediator_broadcast</span>
  <span class='id identifier rubyid_battle'>battle</span><span class='period'>.</span><span class='id identifier rubyid_full_sfen'>full_sfen</span> <span class='op'>=</span> <span class='id identifier rubyid_mediator'>mediator</span><span class='period'>.</span><span class='id identifier rubyid_to_sfen'>to_sfen</span>
  <span class='id identifier rubyid_battle'>battle</span><span class='period'>.</span><span class='id identifier rubyid_turn_max'>turn_max</span> <span class='op'>=</span> <span class='id identifier rubyid_mediator'>mediator</span><span class='period'>.</span><span class='id identifier rubyid_turn_info'>turn_info</span><span class='period'>.</span><span class='id identifier rubyid_turn_max'>turn_max</span>
  <span class='id identifier rubyid_battle'>battle</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>

  <span class='id identifier rubyid_broadcast_hash'>broadcast_hash</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='symbol'>:turn_max</span>        <span class='op'>=&gt;</span> <span class='id identifier rubyid_mediator'>mediator</span><span class='period'>.</span><span class='id identifier rubyid_turn_info'>turn_info</span><span class='period'>.</span><span class='id identifier rubyid_turn_max'>turn_max</span><span class='comma'>,</span>
    <span class='symbol'>:last_hand</span>       <span class='op'>=&gt;</span> <span class='id identifier rubyid_mediator'>mediator</span><span class='period'>.</span><span class='id identifier rubyid_to_ki2_a'>to_ki2_a</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='comma'>,</span> <span class='comment'># 使ってない
</span>    <span class='symbol'>:full_sfen</span>       <span class='op'>=&gt;</span> <span class='id identifier rubyid_battle'>battle</span><span class='period'>.</span><span class='id identifier rubyid_full_sfen'>full_sfen</span><span class='comma'>,</span>
    <span class='symbol'>:human_kifu_text</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_battle'>battle</span><span class='period'>.</span><span class='id identifier rubyid_human_kifu_text'>human_kifu_text</span><span class='comma'>,</span>
    <span class='symbol'>:clock_counts</span>    <span class='op'>=&gt;</span> <span class='id identifier rubyid_battle'>battle</span><span class='period'>.</span><span class='id identifier rubyid_clock_counts'>clock_counts</span><span class='comma'>,</span>
  <span class='rbrace'>}</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_battle'>battle</span><span class='period'>.</span><span class='id identifier rubyid_yomiage_enable'>yomiage_enable</span>
    <span class='id identifier rubyid_broadcast_hash'>broadcast_hash</span><span class='lbracket'>[</span><span class='symbol'>:yomiage</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_mediator'>mediator</span><span class='period'>.</span><span class='id identifier rubyid_hand_logs'>hand_logs</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_yomiage'>yomiage</span>
  <span class='kw'>end</span>

  <span class='const'>ActionCable</span><span class='period'>.</span><span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_broadcast'>broadcast</span><span class='lparen'>(</span><span class='id identifier rubyid_battle'>battle</span><span class='period'>.</span><span class='id identifier rubyid_channel_key'>channel_key</span><span class='comma'>,</span> <span class='id identifier rubyid_broadcast_hash'>broadcast_hash</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="tactic_notify-instance_method">
  
    #<strong>tactic_notify</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>戦法を自動発言</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


159
160
161
162
163
164
165
166
167</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/colosseum/battle/battle_methods.rb', line 159</span>

<span class='kw'>def</span> <span class='id identifier rubyid_tactic_notify'>tactic_notify</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_hand'>hand</span> <span class='op'>=</span> <span class='id identifier rubyid_mediator'>mediator</span><span class='period'>.</span><span class='id identifier rubyid_hand_logs'>hand_logs</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_hand'>hand</span><span class='period'>.</span><span class='id identifier rubyid_skill_set'>skill_set</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
      <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
        <span class='id identifier rubyid_active_user'>active_user</span><span class='period'>.</span><span class='id identifier rubyid_chat_say'>chat_say</span><span class='lparen'>(</span><span class='id identifier rubyid_battle'>battle</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>msg_class:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>has-text-info</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="validate_checkmate_ignore-instance_method">
  
    #<strong>validate_checkmate_ignore</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>現局面で王手放置していたら指した人の負け</p>
<ul><li>
<p>王手放置は合法な手としてすにで指している</p>
</li><li>
<p>そのため王手放置で負けるのは前に指した opponent_player</p>
</li><li>
<p>逆に勝つのは current_player</p>
</li><li>
<p>指した直後にもかかわらず王手の状態になっている -&gt; 王手放置 or 自らピンを外した(自滅)</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


58
59
60
61
62
63</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/colosseum/battle/battle_methods.rb', line 58</span>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_checkmate_ignore'>validate_checkmate_ignore</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_mediator'>mediator</span><span class='period'>.</span><span class='id identifier rubyid_opponent_player'>opponent_player</span><span class='period'>.</span><span class='id identifier rubyid_mate_danger?'>mate_danger?</span>
    <span class='const'><span class='object_link'><a href="../../User.html" title="Colosseum::User (class)">User</a></span></span><span class='period'>.</span><span class='id identifier rubyid_sysop'>sysop</span><span class='period'>.</span><span class='id identifier rubyid_chat_say'>chat_say</span><span class='lparen'>(</span><span class='id identifier rubyid_battle'>battle</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>【反則】</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mediator'>mediator</span><span class='period'>.</span><span class='id identifier rubyid_to_ki2_a'>to_ki2_a</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='embexpr_end'>}</span><span class='tstring_content'>としましたが王手放置または自滅です</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>msg_class:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>has-text-danger</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_battle'>battle</span><span class='period'>.</span><span class='id identifier rubyid_game_end_exit'>game_end_exit</span><span class='lparen'>(</span><span class='label'>win_location_key:</span> <span class='id identifier rubyid_mediator'>mediator</span><span class='period'>.</span><span class='id identifier rubyid_current_player'>current_player</span><span class='period'>.</span><span class='id identifier rubyid_location'>location</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='label'>last_action_key:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ILLEGAL_MOVE</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="win_check-instance_method">
  
    #<strong>win_check</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>次の手番の合法手がない = 詰ました = 勝ち</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


66
67
68
69
70
71
72</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/colosseum/battle/battle_methods.rb', line 66</span>

<span class='kw'>def</span> <span class='id identifier rubyid_win_check'>win_check</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_mediator'>mediator</span><span class='period'>.</span><span class='id identifier rubyid_current_player'>current_player</span><span class='period'>.</span><span class='id identifier rubyid_legal_all_hands'>legal_all_hands</span><span class='period'>.</span><span class='id identifier rubyid_none?'>none?</span>
    <span class='comment'># if mediator.current_player.create_all_hands.none? { |e| e.legal_hand?(mediator) }
</span>    <span class='const'><span class='object_link'><a href="../../User.html" title="Colosseum::User (class)">User</a></span></span><span class='period'>.</span><span class='id identifier rubyid_sysop'>sysop</span><span class='period'>.</span><span class='id identifier rubyid_chat_say'>chat_say</span><span class='lparen'>(</span><span class='id identifier rubyid_battle'>battle</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>【詰み】</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mediator'>mediator</span><span class='period'>.</span><span class='id identifier rubyid_current_player'>current_player</span><span class='period'>.</span><span class='id identifier rubyid_call_name'>call_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>はもう指す手がありません</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>msg_class:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>has-text-danger</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_battle'>battle</span><span class='period'>.</span><span class='id identifier rubyid_game_end_exit'>game_end_exit</span><span class='lparen'>(</span><span class='label'>win_location_key:</span> <span class='id identifier rubyid_mediator'>mediator</span><span class='period'>.</span><span class='id identifier rubyid_opponent_player'>opponent_player</span><span class='period'>.</span><span class='id identifier rubyid_location'>location</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='label'>last_action_key:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TSUMI</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Fri Oct 25 16:12:11 2019 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.20 (ruby-2.6.1).
</div>

    </div>
  </body>
</html>