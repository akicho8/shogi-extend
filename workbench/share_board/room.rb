require File.expand_path('../../../config/environment', __FILE__)
ShareBoard.setup(force: true)

room = ShareBoard::Room.create!
room.redis_clear
# room.redis_rebuild

2.times do |i|
  room.battles.create! do |e|
    e.memberships.build([
        { user_name: "alice", location_key: "black", judge_key: "win",  },
        { user_name: "bob",   location_key: "white", judge_key: "lose", },
        { user_name: "carol", location_key: "black", judge_key: "win",  },
      ])
  end
end

tp room.reload.roomships
room.redis_rebuild
tp room.reload.roomships

# >> |----+---------+---------+-----------+------------+---------------+----------+-------+------+---------------------------+---------------------------|
# >> | id | room_id | user_id | win_count | lose_count | battles_count | win_rate | score | rank | created_at                | updated_at                |
# >> |----+---------+---------+-----------+------------+---------------+----------+-------+------+---------------------------+---------------------------|
# >> |  1 |       1 |       1 |         2 |          0 |             2 |      1.0 |     2 |    1 | 2025-08-03 10:36:05 +0900 | 2025-08-03 10:36:05 +0900 |
# >> |  3 |       1 |       3 |         2 |          0 |             2 |      1.0 |     2 |    1 | 2025-08-03 10:36:05 +0900 | 2025-08-03 10:36:05 +0900 |
# >> |  2 |       1 |       2 |         0 |          2 |             2 |      0.0 |     0 |    3 | 2025-08-03 10:36:05 +0900 | 2025-08-03 10:36:05 +0900 |
# >> |----+---------+---------+-----------+------------+---------------+----------+-------+------+---------------------------+---------------------------|
# >> |----+---------+---------+-----------+------------+---------------+----------+-------+------+---------------------------+---------------------------|
# >> | id | room_id | user_id | win_count | lose_count | battles_count | win_rate | score | rank | created_at                | updated_at                |
# >> |----+---------+---------+-----------+------------+---------------+----------+-------+------+---------------------------+---------------------------|
# >> |  1 |       1 |       1 |         2 |          0 |             2 |      1.0 |     2 |    1 | 2025-08-03 10:36:05 +0900 | 2025-08-03 10:36:05 +0900 |
# >> |  3 |       1 |       3 |         2 |          0 |             2 |      1.0 |     2 |    1 | 2025-08-03 10:36:05 +0900 | 2025-08-03 10:36:05 +0900 |
# >> |  2 |       1 |       2 |         0 |          2 |             2 |      0.0 |     0 |    3 | 2025-08-03 10:36:05 +0900 | 2025-08-03 10:36:05 +0900 |
# >> |----+---------+---------+-----------+------------+---------------+----------+-------+------+---------------------------+---------------------------|
