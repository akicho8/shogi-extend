require "#{__dir__}/setup"
ShareBoard.setup(force: true)

params = {
  :room_key  => "dev_room",
  :title     => "共有将棋盤",
  :sfen      => "position sfen lnsgkgsnl/1r5b1/ppppppppp/9/9/9/PPPPPPPPP/1B5R1/LNSGKGSNL b - 1",
  :turn      => 0,
  :win_location_key => :black,
  :memberships => [
    { :user_name => "a", :location_key => "black", :judge_key => "lose", },
    { :user_name => "b", :location_key => "white", :judge_key => "win",  },
    { :user_name => "c", :location_key => "black", :judge_key => "lose", },
    { :user_name => "d", :location_key => "white", :judge_key => "win",  },
  ],
}

battle_create = ShareBoard::BattleCreate.new(params)
battle_create.call
tp battle_create.battle.room
tp battle_create.battle
tp battle_create.battle.memberships
tp battle_create.battle.room.users
# >> |---------------------+---------------------------|
# >> |                  id | 1                         |
# >> |                 key | dev_room                  |
# >> |       battles_count | 1                         |
# >> |          created_at | 2025-08-05 15:48:52 +0900 |
# >> |          updated_at | 2025-08-05 15:48:52 +0900 |
# >> | chat_messages_count | 0                         |
# >> |---------------------+---------------------------|
# >> |-----------------+-------------------------------------------------------------------------------|
# >> |              id | 1                                                                             |
# >> |         room_id | 1                                                                             |
# >> |             key | e800861a837207cde9bab12173bfd6b5                                              |
# >> |           title | 共有将棋盤                                                                    |
# >> |            sfen | position sfen lnsgkgsnl/1r5b1/ppppppppp/9/9/9/PPPPPPPPP/1B5R1/LNSGKGSNL b - 1 |
# >> |            turn | 0                                                                             |
# >> | win_location_id | 1                                                                             |
# >> |        position | 0                                                                             |
# >> |      created_at | 2025-08-05 15:48:52 +0900                                                     |
# >> |      updated_at | 2025-08-05 15:48:52 +0900                                                     |
# >> |-----------------+-------------------------------------------------------------------------------|
# >> |----+-----------+---------+----------+-------------+----------+---------------------------+---------------------------|
# >> | id | battle_id | user_id | judge_id | location_id | position | created_at                | updated_at                |
# >> |----+-----------+---------+----------+-------------+----------+---------------------------+---------------------------|
# >> |  1 |         1 |       1 |        2 |           1 |        0 | 2025-08-05 15:48:52 +0900 | 2025-08-05 15:48:52 +0900 |
# >> |  2 |         1 |       2 |        1 |           2 |        1 | 2025-08-05 15:48:52 +0900 | 2025-08-05 15:48:52 +0900 |
# >> |  3 |         1 |       3 |        2 |           1 |        2 | 2025-08-05 15:48:52 +0900 | 2025-08-05 15:48:52 +0900 |
# >> |  4 |         1 |       4 |        1 |           2 |        3 | 2025-08-05 15:48:52 +0900 | 2025-08-05 15:48:52 +0900 |
# >> |----+-----------+---------+----------+-------------+----------+---------------------------+---------------------------|
# >> |----+------+-------------------+---------------------------+---------------------------+---------------------|
# >> | id | name | memberships_count | created_at                | updated_at                | chat_messages_count |
# >> |----+------+-------------------+---------------------------+---------------------------+---------------------|
# >> |  1 | a    |                 1 | 2025-08-05 15:48:52 +0900 | 2025-08-05 15:48:52 +0900 |                   0 |
# >> |  2 | b    |                 1 | 2025-08-05 15:48:52 +0900 | 2025-08-05 15:48:52 +0900 |                   0 |
# >> |  3 | c    |                 1 | 2025-08-05 15:48:52 +0900 | 2025-08-05 15:48:52 +0900 |                   0 |
# >> |  4 | d    |                 1 | 2025-08-05 15:48:52 +0900 | 2025-08-05 15:48:52 +0900 |                   0 |
# >> |----+------+-------------------+---------------------------+---------------------------+---------------------|
