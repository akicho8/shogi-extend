require "#{__dir__}/setup"
Ppl.setup_for_workbench
Ppl::Updater.update_raw(5, { mentor: "X", name: "alice", })
Ppl::Updater.update_raw(6, { mentor: "Y", name: "bob",   })
Ppl::Updater.update_raw(7, { mentor: "Z", name: "carol", })
sql
Ppl::User.search(name: "a").collect(&:name)                    # => ["carol", "alice", "bob"]
# Ppl::User.search(season_number: "6").collect(&:name)           # => ["bob"]
# Ppl::User.search(mentor_name: "X").collect(&:name)             # => ["alice"]
# Ppl::User.search(query: "a").collect(&:name)                   # => ["carol", "alice"]
# 
# Ppl.setup_for_workbench
# Ppl::Updater.update_raw(5, { mentor: "X", name: "alice", })
# Ppl::User.search(mentor_name: "X", query: "a").collect(&:name) # => ["alice"]
# >>   Ppl::User Load (0.2ms)  SELECT `ppl_users`.* FROM `ppl_users` WHERE `ppl_users`.`name` = 'a' /*application='ShogiWeb'*/
# >>   â†³ app/models/ppl/user_search.rb:23:in 'Ppl::UserSearch#call'
# >>   SQL (1.3ms)  SELECT `ppl_users`.`id` AS t0_r0, `ppl_users`.`rank_id` AS t0_r1, `ppl_users`.`mentor_id` AS t0_r2, `ppl_users`.`name` AS t0_r3, `ppl_users`.`age_min` AS t0_r4, `ppl_users`.`age_max` AS t0_r5, `ppl_users`.`runner_up_count` AS t0_r6, `ppl_users`.`win_max` AS t0_r7, `ppl_users`.`total_win` AS t0_r8, `ppl_users`.`total_lose` AS t0_r9, `ppl_users`.`win_ratio` AS t0_r10, `ppl_users`.`promotion_membership_id` AS t0_r11, `ppl_users`.`promotion_season_number` AS t0_r12, `ppl_users`.`promotion_win` AS t0_r13, `ppl_users`.`memberships_first_id` AS t0_r14, `ppl_users`.`season_number_min` AS t0_r15, `ppl_users`.`memberships_last_id` AS t0_r16, `ppl_users`.`season_number_max` AS t0_r17, `ppl_users`.`deactivated_season_number` AS t0_r18, `ppl_users`.`memberships_count` AS t0_r19, `ppl_users`.`created_at` AS t0_r20, `ppl_users`.`updated_at` AS t0_r21, `ppl_ranks`.`id` AS t1_r0, `ppl_ranks`.`key` AS t1_r1, `ppl_ranks`.`position` AS t1_r2, `ppl_ranks`.`created_at` AS t1_r3, `ppl_ranks`.`updated_at` AS t1_r4, `ppl_mentors`.`id` AS t2_r0, `ppl_mentors`.`name` AS t2_r1, `ppl_mentors`.`users_count` AS t2_r2, `ppl_mentors`.`created_at` AS t2_r3, `ppl_mentors`.`updated_at` AS t2_r4, `ppl_memberships`.`id` AS t3_r0, `ppl_memberships`.`league_season_id` AS t3_r1, `ppl_memberships`.`user_id` AS t3_r2, `ppl_memberships`.`result_id` AS t3_r3, `ppl_memberships`.`start_pos` AS t3_r4, `ppl_memberships`.`age` AS t3_r5, `ppl_memberships`.`win` AS t3_r6, `ppl_memberships`.`lose` AS t3_r7, `ppl_memberships`.`ox` AS t3_r8, `ppl_memberships`.`created_at` AS t3_r9, `ppl_memberships`.`updated_at` AS t3_r10, `users_ppl_memberships`.`id` AS t4_r0, `users_ppl_memberships`.`rank_id` AS t4_r1, `users_ppl_memberships`.`mentor_id` AS t4_r2, `users_ppl_memberships`.`name` AS t4_r3, `users_ppl_memberships`.`age_min` AS t4_r4, `users_ppl_memberships`.`age_max` AS t4_r5, `users_ppl_memberships`.`runner_up_count` AS t4_r6, `users_ppl_memberships`.`win_max` AS t4_r7, `users_ppl_memberships`.`total_win` AS t4_r8, `users_ppl_memberships`.`total_lose` AS t4_r9, `users_ppl_memberships`.`win_ratio` AS t4_r10, `users_ppl_memberships`.`promotion_membership_id` AS t4_r11, `users_ppl_memberships`.`promotion_season_number` AS t4_r12, `users_ppl_memberships`.`promotion_win` AS t4_r13, `users_ppl_memberships`.`memberships_first_id` AS t4_r14, `users_ppl_memberships`.`season_number_min` AS t4_r15, `users_ppl_memberships`.`memberships_last_id` AS t4_r16, `users_ppl_memberships`.`season_number_max` AS t4_r17, `users_ppl_memberships`.`deactivated_season_number` AS t4_r18, `users_ppl_memberships`.`memberships_count` AS t4_r19, `users_ppl_memberships`.`created_at` AS t4_r20, `users_ppl_memberships`.`updated_at` AS t4_r21, `ppl_league_seasons`.`id` AS t5_r0, `ppl_league_seasons`.`season_number` AS t5_r1, `ppl_league_seasons`.`created_at` AS t5_r2, `ppl_league_seasons`.`updated_at` AS t5_r3, `ppl_results`.`id` AS t6_r0, `ppl_results`.`key` AS t6_r1, `ppl_results`.`position` AS t6_r2, `ppl_results`.`created_at` AS t6_r3, `ppl_results`.`updated_at` AS t6_r4 FROM `ppl_users` LEFT OUTER JOIN `ppl_ranks` ON `ppl_ranks`.`id` = `ppl_users`.`rank_id` LEFT OUTER JOIN `ppl_mentors` ON `ppl_mentors`.`id` = `ppl_users`.`mentor_id` LEFT OUTER JOIN `ppl_memberships` ON `ppl_memberships`.`user_id` = `ppl_users`.`id` LEFT OUTER JOIN `ppl_users` `users_ppl_memberships` ON `users_ppl_memberships`.`id` = `ppl_memberships`.`user_id` LEFT OUTER JOIN `ppl_league_seasons` ON `ppl_league_seasons`.`id` = `ppl_memberships`.`league_season_id` LEFT OUTER JOIN `ppl_results` ON `ppl_results`.`id` = `ppl_memberships`.`result_id` ORDER BY `ppl_ranks`.`position` ASC, `ppl_users`.`promotion_season_number` ASC, `ppl_users`.`promotion_win` DESC, `ppl_users`.`runner_up_count` DESC, `ppl_users`.`age_min` ASC, `ppl_users`.`memberships_count` ASC /*application='ShogiWeb'*/
