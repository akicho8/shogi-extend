require "#{__dir__}/setup"
Ppl.setup_for_workbench
Ppl::Updater.update_raw(5, { name: "XA", result_key: "維持" })
Ppl::Updater.update_raw(6, { name: "BX", result_key: "維持" })
Ppl::User.plus_minus_search("A -B").collect(&:name) == ["XA"] # => true

Ppl.setup_for_workbench
Ppl::Updater.update_raw(5, { name: "alice", result_key: "維持", age: 1, win: 3 })
Ppl::Updater.update_raw(6, { name: "alice", result_key: "次点", age: 2, win: 2 })
Ppl::Updater.update_raw(7, { name: "alice", result_key: "昇段", age: 3, win: 1 })
user = Ppl::User["alice"]
user.min_age                                # => 1
user.max_age                                # => 3
user.runner_up_count                        # => 1
user.max_win                                # => 3
user.promotion_membership.league.generation # => 7
user.promotion_generation                   # => 7
user.promotion_win                          # => 1
user.min_membership.league.generation       # => 5
user.max_membership.league.generation       # => 7
user.min_generation                         # => 5
user.max_generation                         # => 7
tp Ppl::League
tp Ppl::User
tp Ppl::Membership
# >> |-----+------------+---------------------------+---------------------------|
# >> | id  | generation | created_at                | updated_at                |
# >> |-----+------------+---------------------------+---------------------------|
# >> | 141 |          5 | 2025-08-14 18:40:32 +0900 | 2025-08-14 18:40:32 +0900 |
# >> | 142 |          6 | 2025-08-14 18:40:32 +0900 | 2025-08-14 18:40:32 +0900 |
# >> | 143 |          7 | 2025-08-14 18:40:32 +0900 | 2025-08-14 18:40:32 +0900 |
# >> |-----+------------+---------------------------+---------------------------|
# >> |-----+-------+---------+---------+-----------------+---------+-------------------------+----------------------+---------------+-------------------+----------------+-------------------+----------------+-------------------+---------------------------+---------------------------|
# >> | id  | name  | min_age | max_age | runner_up_count | max_win | promotion_membership_id | promotion_generation | promotion_win | min_membership_id | min_generation | max_membership_id | max_generation | memberships_count | created_at                | updated_at                |
# >> |-----+-------+---------+---------+-----------------+---------+-------------------------+----------------------+---------------+-------------------+----------------+-------------------+----------------+-------------------+---------------------------+---------------------------|
# >> | 608 | alice |       1 |       3 |               1 |       3 |                    2546 |                    7 |             1 |              2544 |              5 |              2546 |              7 |                 3 | 2025-08-14 18:40:32 +0900 | 2025-08-14 18:40:32 +0900 |
# >> |-----+-------+---------+---------+-----------------+---------+-------------------------+----------------------+---------------+-------------------+----------------+-------------------+----------------+-------------------+---------------------------+---------------------------|
# >> |------+-----------+---------+-----------+-----------+-----+-----+------+----+---------------------------+---------------------------|
# >> | id   | league_id | user_id | result_id | start_pos | age | win | lose | ox | created_at                | updated_at                |
# >> |------+-----------+---------+-----------+-----------+-----+-----+------+----+---------------------------+---------------------------|
# >> | 2544 |       141 |     608 |         4 |         0 |   1 |   3 |    0 |    | 2025-08-14 18:40:32 +0900 | 2025-08-14 18:40:32 +0900 |
# >> | 2545 |       142 |     608 |         3 |         0 |   2 |   2 |    0 |    | 2025-08-14 18:40:32 +0900 | 2025-08-14 18:40:32 +0900 |
# >> | 2546 |       143 |     608 |         1 |         0 |   3 |   1 |    0 |    | 2025-08-14 18:40:32 +0900 | 2025-08-14 18:40:32 +0900 |
# >> |------+-----------+---------+-----------+-----------+-----+-----+------+----+---------------------------+---------------------------|
