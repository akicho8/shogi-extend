require "#{__dir__}/setup"
Ppl.setup_for_workbench
Ppl::Updater.update_raw(5, { name: "XA", result_key: "維持" })
Ppl::Updater.update_raw(6, { name: "BX", result_key: "維持" })
Ppl::User.plus_minus_search("A -B").collect(&:name) == ["XA"] # => true

Ppl.setup_for_workbench
Ppl::Updater.update_raw(5, { name: "alice", result_key: "維持", age: 1, win: 3 })
Ppl::Updater.update_raw(6, { name: "alice", result_key: "次点", age: 2, win: 2 })
Ppl::Updater.update_raw(7, { name: "alice", result_key: "昇段", age: 3, win: 1 })
user = Ppl::User["alice"]
user.age_min                                # => 1
user.age_max                                # => 3
user.runner_up_count                        # => 1
user.win_max                                # => 3
user.promotion_membership.league_season.season_number # => 7
user.promotion_season_number                   # => 7
user.promotion_win                          # => 1
user.memberships_first.league_season.season_number       # => 5
user.memberships_last.league_season.season_number       # => 7
user.season_number_min                         # => 5
user.season_number_max                         # => 7
tp Ppl::LeagueSeason
tp Ppl::User
tp Ppl::Membership
# >> |-----+------------+---------------------------+---------------------------|
# >> | id  | season_number | created_at                | updated_at                |
# >> |-----+------------+---------------------------+---------------------------|
# >> | 141 |          5 | 2025-08-14 18:40:32 +0900 | 2025-08-14 18:40:32 +0900 |
# >> | 142 |          6 | 2025-08-14 18:40:32 +0900 | 2025-08-14 18:40:32 +0900 |
# >> | 143 |          7 | 2025-08-14 18:40:32 +0900 | 2025-08-14 18:40:32 +0900 |
# >> |-----+------------+---------------------------+---------------------------|
# >> |-----+-------+---------+---------+-----------------+---------+-------------------------+----------------------+---------------+-------------------+----------------+-------------------+----------------+-------------------+---------------------------+---------------------------|
# >> | id  | name  | age_min | age_max | runner_up_count | win_max | promotion_membership_id | promotion_season_number | promotion_win | memberships_first_id | season_number_min | memberships_last_id | season_number_max | memberships_count | created_at                | updated_at                |
# >> |-----+-------+---------+---------+-----------------+---------+-------------------------+----------------------+---------------+-------------------+----------------+-------------------+----------------+-------------------+---------------------------+---------------------------|
# >> | 608 | alice |       1 |       3 |               1 |       3 |                    2546 |                    7 |             1 |              2544 |              5 |              2546 |              7 |                 3 | 2025-08-14 18:40:32 +0900 | 2025-08-14 18:40:32 +0900 |
# >> |-----+-------+---------+---------+-----------------+---------+-------------------------+----------------------+---------------+-------------------+----------------+-------------------+----------------+-------------------+---------------------------+---------------------------|
# >> |------+-----------+---------+-----------+-----------+-----+-----+------+----+---------------------------+---------------------------|
# >> | id   | league_season_id | user_id | result_id | start_pos | age | win | lose | ox | created_at                | updated_at                |
# >> |------+-----------+---------+-----------+-----------+-----+-----+------+----+---------------------------+---------------------------|
# >> | 2544 |       141 |     608 |         4 |         0 |   1 |   3 |    0 |    | 2025-08-14 18:40:32 +0900 | 2025-08-14 18:40:32 +0900 |
# >> | 2545 |       142 |     608 |         3 |         0 |   2 |   2 |    0 |    | 2025-08-14 18:40:32 +0900 | 2025-08-14 18:40:32 +0900 |
# >> | 2546 |       143 |     608 |         1 |         0 |   3 |   1 |    0 |    | 2025-08-14 18:40:32 +0900 | 2025-08-14 18:40:32 +0900 |
# >> |------+-----------+---------+-----------+-----------+-----+-----+------+----+---------------------------+---------------------------|
