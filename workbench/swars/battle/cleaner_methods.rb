require "./setup"
sql
Swars::Battle.limit(nil).old_only(50.days).count          # => 794678
Swars::Battle.limit(nil).pro_only.count                   # => 17362
Swars::Battle.limit(nil).pro_except.count                 # => 1780260
Swars::Battle.limit(nil).ban_only.count                   # => 4595
Swars::Battle.limit(nil).ban_except.count                 # => 1793027
Swars::Battle.limit(nil).user_only("SiroChannel").count   # => 4
Swars::Battle.limit(nil).user_except("SiroChannel").count # => 1797618
Swars::Battle.limit(nil).xmode_only("指導").count         # => 17401
Swars::Battle.limit(nil).xmode_except("指導").count       # => 1780221
Swars::Battle.limit(nil).coaching_only.count              # => 17401
Swars::Battle.limit(nil).coaching_except.count            # => 1780221
Swars::Battle.drop_scope1.count                    # => 1674442
Swars::Battle.drop_scope2.count                    # => 46101
# >>   Swars::Battle Count (245.9ms)  SELECT COUNT(*) FROM `swars_battles` WHERE `swars_battles`.`accessed_at` <= '2024-05-17 06:36:42'
# >>   Swars::Grade Load (0.3ms)  SELECT `swars_grades`.* FROM `swars_grades` WHERE `swars_grades`.`key` = '十段' ORDER BY `swars_grades`.`priority` ASC LIMIT 1
# >>   ↳ app/models/application_memory_record.rb:22:in `db_record!'
# >>   Swars::Battle Count (154.7ms)  SELECT COUNT(DISTINCT `swars_battles`.`id`) FROM `swars_battles` INNER JOIN `swars_memberships` ON `swars_memberships`.`battle_id` = `swars_battles`.`id` WHERE `swars_memberships`.`grade_id` = 40
# >>   Swars::Grade Load (0.5ms)  SELECT `swars_grades`.* FROM `swars_grades` WHERE `swars_grades`.`key` = '十段' ORDER BY `swars_grades`.`priority` ASC LIMIT 1
# >>   ↳ app/models/application_memory_record.rb:22:in `db_record!'
# >>   Swars::Battle Count (437.7ms)  SELECT COUNT(*) FROM `swars_battles` WHERE `swars_battles`.`id` NOT IN (SELECT `swars_memberships`.`battle_id` FROM `swars_memberships` WHERE `swars_memberships`.`grade_id` = 40)
# >>   Swars::Battle Count (93.6ms)  SELECT COUNT(DISTINCT `swars_battles`.`id`) FROM `swars_battles` INNER JOIN `swars_memberships` ON `swars_memberships`.`battle_id` = `swars_battles`.`id` WHERE `swars_memberships`.`user_id` IN (SELECT `swars_users`.`id` FROM `swars_users` WHERE `swars_users`.`ban_at` IS NOT NULL)
# >>   Swars::Battle Count (644.3ms)  SELECT COUNT(*) FROM `swars_battles` WHERE `swars_battles`.`id` NOT IN (SELECT `swars_memberships`.`battle_id` FROM `swars_memberships` WHERE `swars_memberships`.`user_id` IN (SELECT `swars_users`.`id` FROM `swars_users` WHERE `swars_users`.`ban_at` IS NOT NULL))
# >>   Swars::Battle Count (0.7ms)  SELECT COUNT(DISTINCT `swars_battles`.`id`) FROM `swars_battles` INNER JOIN `swars_memberships` ON `swars_memberships`.`battle_id` = `swars_battles`.`id` WHERE `swars_memberships`.`user_id` IN (SELECT `swars_users`.`id` FROM `swars_users` WHERE `swars_users`.`user_key` = 'SiroChannel')
# >>   Swars::Battle Count (349.4ms)  SELECT COUNT(*) FROM `swars_battles` WHERE `swars_battles`.`id` NOT IN (SELECT `swars_memberships`.`battle_id` FROM `swars_memberships` WHERE `swars_memberships`.`user_id` IN (SELECT `swars_users`.`id` FROM `swars_users` WHERE `swars_users`.`user_key` = 'SiroChannel'))
# >>   Swars::Battle Count (7.8ms)  SELECT COUNT(*) FROM `swars_battles` WHERE `swars_battles`.`xmode_id` IN (SELECT `swars_xmodes`.`id` FROM `swars_xmodes` WHERE `swars_xmodes`.`key` = '指導' ORDER BY `swars_xmodes`.`position` ASC)
# >>   Swars::Battle Count (321.6ms)  SELECT COUNT(*) FROM `swars_battles` WHERE `swars_battles`.`xmode_id` NOT IN (SELECT `swars_xmodes`.`id` FROM `swars_xmodes` WHERE `swars_xmodes`.`key` = '指導' ORDER BY `swars_xmodes`.`position` ASC)
# >>   Swars::Battle Count (2.6ms)  SELECT COUNT(*) FROM `swars_battles` WHERE `swars_battles`.`xmode_id` IN (SELECT `swars_xmodes`.`id` FROM `swars_xmodes` WHERE `swars_xmodes`.`key` = '指導' ORDER BY `swars_xmodes`.`position` ASC)
# >>   Swars::Battle Count (309.4ms)  SELECT COUNT(*) FROM `swars_battles` WHERE `swars_battles`.`xmode_id` NOT IN (SELECT `swars_xmodes`.`id` FROM `swars_xmodes` WHERE `swars_xmodes`.`key` = '指導' ORDER BY `swars_xmodes`.`position` ASC)
# >>   Swars::Battle Count (6497.3ms)  SELECT COUNT(*) FROM `swars_battles` WHERE `swars_battles`.`id` NOT IN (SELECT `swars_memberships`.`battle_id` FROM `swars_memberships` WHERE `swars_memberships`.`user_id` IN (SELECT `swars_users`.`id` FROM `swars_users` WHERE `swars_users`.`ban_at` IS NOT NULL)) AND `swars_battles`.`accessed_at` <= '2024-07-06 06:36:45' AND `swars_battles`.`id` NOT IN (SELECT `swars_memberships`.`battle_id` FROM `swars_memberships` WHERE `swars_memberships`.`user_id` IN (SELECT `swars_users`.`id` FROM `swars_users` WHERE `swars_users`.`user_key` IN ('RYO_CHiN_', 'kallsium', 'Mibuki0101', 'sea_sky_', 'kallsium', 'Jyohshin', 'KURONEKOFUKU', 'NT1679', 'Omannyawa', 'RYO_ChHiN_', 'Ritsumeikan_APU', 'SATORI99', 'Shisakugata', 'Tokusyo_1', 'UMR_summer', 'abacus10', 'akihiko810', 'eternalvirgin', 'gagagakuma', 'gomiress', 'hide_yuki_kun', 'kamiosa', 'kawa_toshi_1', 'maiyahi4649', 'molcar', 'mosangun', 'nao_frag', 'nisiyan0204', 'pooh1122N', 'puniho', 'seiryuushogi', 'shinbigium', 'sirokurumi', 'slowstep3210', 'slowstep5678', 'kzts', 'stampedeod', 'staygold3377', 'waiem_0827', 'yinhe', 'yukky1119', 'zun_y', 'BOUYATETSU5', 'itoshinTV', 'Taichan0601', 'MurachanLions', 'suzukihajime', 'erikokouza', 'pagagm', 'Manaochannel', 'TOBE_CHAN', 'ideon_shogi', 'Odenryu', 'Dsuke213', 'Moka_K', 'totutohoku', 'mo_ri_', 'PARM_shogi_CH_', 'ahirutaityouZ', 'ryutaro1991', 'omuomun', 'aya_s_love', 'Seigo_S', 'IrUkAzz', 'raikachess', 'TYosTYos', 'okayama_shogi', 'YT_Dash', 'MartinRiggs', 'MaisonMargiela', 'kanikubo73', '9114aaxt', 'AHIRU_MAN_', 'Ayaseaya', 'Choco_math', 'EffectTarou', 'FujitaAoi', 'Gotanda_N', 'H_Britney', 'Kaku_Kiriko', 'Kousaka_Makuri', 'NgisaNagi', 'RIKISEN_shogi', 'ShowYanChannel', 'SugarHuuko', 'Sukonbu3', 'Sushi_Kuine', 'Sylvamiya', 'UtadaHikaru', 'YARD_CHANNEL', 'anpirika', 'bsplive', 'chisei_mazawa', 'chrono_', 'garo0926', 'gorirakouen', 'hakuyoutu', 'mafuneko', 'micro77', 'mokkun_mokumoku', 'morusuko', 'naruru55', 'ray_nanakawa', 'saisai_shogi', 'verdura', 'yomeP', 'polunga_shogi', 'si_kun_YouTuber', 'Ada_Tsugamachi', 'tayayan_ts', 'kaorin55', 'sakuya_T', 'kimbrelp', 'Traumonac', 'Mitsuki_YouTube', 'momotetsunokami', 'MisoJennifer', 'HomuPaka', 'AygoN7', 'Osaka_Referee', 'shoshirasaka', 'chacopipi0516', 'monkeykong', 'seiryuu1230', 'hisana1', 'harungun', 'kd2001', 'Kaori3159', 'ariakedo', '443443443', 'piyomaru_shogi', 'hebosugiChan', 'IKEMENKISHI', 'ANAGUMA4MAI', 'H_Kirara', 'Jerry_Shogi', 'M_10032', 'Serumasama', 'TokiwadaiMei', 'Weiss_Hairi', 'asa2yoru', 'chodo', 'kisamoko', 'mai_ueo', 'takayukiando', 'tora9900_torara', 'yadamon2525', 'yoru0000', 'hanabi7711', 'nananamin', 'ds4', 'wata1417', 'katoayumn', 'daiwajpjp', 'yamaloveuma', 'HIKOUKI_GUMO', 'ultimate701', 'terauching', 'daichukikikuchi', 'santa_ABC', 'arminn', 'Hey_Ya', 'sleepycat', 'tanukitirou', 'zibakuou', 'Janne1', 'alonPlay', 'k_tp', 'sanawaka', 'BOUYATETSU5', 'itoshinTV', 'Taichan0601', 'MurachanLions', 'suzukihajime', 'erikokouza', 'pagagm', 'Manaochannel', 'TOBE_CHAN', 'ideon_shogi', 'Odenryu', 'Dsuke213', 'SiroChannel'))) AND `swars_battles`.`xmode_id` IN (SELECT `swars_xmodes`.`id` FROM `swars_xmodes` WHERE `swars_xmodes`.`key` = '野良' ORDER BY `swars_xmodes`.`position` ASC)
# >>   Swars::Battle Count (1643.1ms)  SELECT COUNT(DISTINCT `swars_battles`.`id`) FROM `swars_battles` INNER JOIN `swars_memberships` ON `swars_memberships`.`battle_id` = `swars_battles`.`id` WHERE `swars_battles`.`id` NOT IN (SELECT `swars_memberships`.`battle_id` FROM `swars_memberships` WHERE `swars_memberships`.`user_id` IN (SELECT `swars_users`.`id` FROM `swars_users` WHERE `swars_users`.`ban_at` IS NOT NULL)) AND `swars_battles`.`accessed_at` <= '2024-07-06 06:36:51' AND `swars_memberships`.`user_id` IN (SELECT `swars_users`.`id` FROM `swars_users` WHERE `swars_users`.`user_key` IN ('RYO_CHiN_', 'kallsium', 'Mibuki0101', 'sea_sky_', 'kallsium', 'Jyohshin', 'KURONEKOFUKU', 'NT1679', 'Omannyawa', 'RYO_ChHiN_', 'Ritsumeikan_APU', 'SATORI99', 'Shisakugata', 'Tokusyo_1', 'UMR_summer', 'abacus10', 'akihiko810', 'eternalvirgin', 'gagagakuma', 'gomiress', 'hide_yuki_kun', 'kamiosa', 'kawa_toshi_1', 'maiyahi4649', 'molcar', 'mosangun', 'nao_frag', 'nisiyan0204', 'pooh1122N', 'puniho', 'seiryuushogi', 'shinbigium', 'sirokurumi', 'slowstep3210', 'slowstep5678', 'kzts', 'stampedeod', 'staygold3377', 'waiem_0827', 'yinhe', 'yukky1119', 'zun_y', 'BOUYATETSU5', 'itoshinTV', 'Taichan0601', 'MurachanLions', 'suzukihajime', 'erikokouza', 'pagagm', 'Manaochannel', 'TOBE_CHAN', 'ideon_shogi', 'Odenryu', 'Dsuke213', 'Moka_K', 'totutohoku', 'mo_ri_', 'PARM_shogi_CH_', 'ahirutaityouZ', 'ryutaro1991', 'omuomun', 'aya_s_love', 'Seigo_S', 'IrUkAzz', 'raikachess', 'TYosTYos', 'okayama_shogi', 'YT_Dash', 'MartinRiggs', 'MaisonMargiela', 'kanikubo73', '9114aaxt', 'AHIRU_MAN_', 'Ayaseaya', 'Choco_math', 'EffectTarou', 'FujitaAoi', 'Gotanda_N', 'H_Britney', 'Kaku_Kiriko', 'Kousaka_Makuri', 'NgisaNagi', 'RIKISEN_shogi', 'ShowYanChannel', 'SugarHuuko', 'Sukonbu3', 'Sushi_Kuine', 'Sylvamiya', 'UtadaHikaru', 'YARD_CHANNEL', 'anpirika', 'bsplive', 'chisei_mazawa', 'chrono_', 'garo0926', 'gorirakouen', 'hakuyoutu', 'mafuneko', 'micro77', 'mokkun_mokumoku', 'morusuko', 'naruru55', 'ray_nanakawa', 'saisai_shogi', 'verdura', 'yomeP', 'polunga_shogi', 'si_kun_YouTuber', 'Ada_Tsugamachi', 'tayayan_ts', 'kaorin55', 'sakuya_T', 'kimbrelp', 'Traumonac', 'Mitsuki_YouTube', 'momotetsunokami', 'MisoJennifer', 'HomuPaka', 'AygoN7', 'Osaka_Referee', 'shoshirasaka', 'chacopipi0516', 'monkeykong', 'seiryuu1230', 'hisana1', 'harungun', 'kd2001', 'Kaori3159', 'ariakedo', '443443443', 'piyomaru_shogi', 'hebosugiChan', 'IKEMENKISHI', 'ANAGUMA4MAI', 'H_Kirara', 'Jerry_Shogi', 'M_10032', 'Serumasama', 'TokiwadaiMei', 'Weiss_Hairi', 'asa2yoru', 'chodo', 'kisamoko', 'mai_ueo', 'takayukiando', 'tora9900_torara', 'yadamon2525', 'yoru0000', 'hanabi7711', 'nananamin', 'ds4', 'wata1417', 'katoayumn', 'daiwajpjp', 'yamaloveuma', 'HIKOUKI_GUMO', 'ultimate701', 'terauching', 'daichukikikuchi', 'santa_ABC', 'arminn', 'Hey_Ya', 'sleepycat', 'tanukitirou', 'zibakuou', 'Janne1', 'alonPlay', 'k_tp', 'sanawaka')) AND `swars_battles`.`id` NOT IN (SELECT `swars_memberships`.`battle_id` FROM `swars_memberships` WHERE `swars_memberships`.`user_id` IN (SELECT `swars_users`.`id` FROM `swars_users` WHERE `swars_users`.`user_key` IN ('BOUYATETSU5', 'itoshinTV', 'Taichan0601', 'MurachanLions', 'suzukihajime', 'erikokouza', 'pagagm', 'Manaochannel', 'TOBE_CHAN', 'ideon_shogi', 'Odenryu', 'Dsuke213', 'SiroChannel'))) AND `swars_battles`.`xmode_id` IN (SELECT `swars_xmodes`.`id` FROM `swars_xmodes` WHERE `swars_xmodes`.`key` = '野良' ORDER BY `swars_xmodes`.`position` ASC)
