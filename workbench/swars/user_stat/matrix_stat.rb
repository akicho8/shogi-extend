require "./setup"

# ActsAsTaggableOn.force_binary_collation = true
ActsAsTaggableOn.strict_case_match = true
_ { Swars::User["SugarHuuko"].user_stat(sample_max: 200).matrix_stat.to_all_chart } # => "642.23 ms"
_ { Swars::User["SugarHuuko"].user_stat(sample_max: 200).matrix_stat.to_all_chart } # => "586.98 ms"
ActsAsTaggableOn.strict_case_match = false
_ { Swars::User["SugarHuuko"].user_stat(sample_max: 200).matrix_stat.to_all_chart } # => "923.52 ms"
_ { Swars::User["SugarHuuko"].user_stat(sample_max: 200).matrix_stat.to_all_chart } # => "911.21 ms"

# sql
# s = Swars::User["SugarHuuko"].user_stat(sample_max: 5).ids_scope
# s.ids
# s.ids
# s.ids
# s.ids

# a = [{:tag=>{"name"=>"力戦", "count"=>67}, :appear_ratio=>0.335, :judge_counts=>{"lose"=>16, "win"=>49, "draw"=>2}}, {:tag=>{"name"=>"UFO銀", "count"=>13}, :appear_ratio=>0.065, :judge_counts=>{"win"=>11, "lose"=>2}}, {:tag=>{"name"=>"へなちょこ急戦", "count"=>13}, :appear_ratio=>0.065, :judge_counts=>{"win"=>10, "lose"=>2, "draw"=>1}}, {:tag=>{"name"=>"角交換型", "count"=>10}, :appear_ratio=>0.05, :judge_counts=>{"lose"=>3, "win"=>7}}, {:tag=>{"name"=>"原始棒銀", "count"=>7}, :appear_ratio=>0.035, :judge_counts=>{"win"=>7}}, {:tag=>{"name"=>"▲４五歩早仕掛け", "count"=>6}, :appear_ratio=>0.03, :judge_counts=>{"win"=>6}}, {:tag=>{"name"=>"相掛かり", "count"=>5}, :appear_ratio=>0.025, :judge_counts=>{"lose"=>1, "win"=>4}}, {:tag=>{"name"=>"銀雲雀", "count"=>5}, :appear_ratio=>0.025, :judge_counts=>{"win"=>4, "lose"=>1}}, {:tag=>{"name"=>"手得角交換型", "count"=>5}, :appear_ratio=>0.025, :judge_counts=>{"win"=>4, "lose"=>1}}, {:tag=>{"name"=>"地下鉄飛車", "count"=>4}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>1, "win"=>3}}, {:tag=>{"name"=>"角換わり", "count"=>4}, :appear_ratio=>0.02, :judge_counts=>{"win"=>3, "lose"=>1}}, {:tag=>{"name"=>"棒銀", "count"=>4}, :appear_ratio=>0.02, :judge_counts=>{"win"=>3, "lose"=>1}}, {:tag=>{"name"=>"対振り持久戦", "count"=>3}, :appear_ratio=>0.015, :judge_counts=>{"win"=>3}}, {:tag=>{"name"=>"相掛かり棒銀", "count"=>2}, :appear_ratio=>0.01, :judge_counts=>{"lose"=>1, "win"=>1}}, {:tag=>{"name"=>"右四間飛車", "count"=>2}, :appear_ratio=>0.01, :judge_counts=>{"win"=>2}}, {:tag=>{"name"=>"阿久津流急戦矢倉", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"33金型早繰り銀", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"６筋位取り", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"屋敷流二枚銀", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"△３三角型空中戦法", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"袖飛車", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"相振り飛車", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"横歩取り", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"角換わり腰掛け銀", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}]
# b = Swars::User["SugarHuuko"].user_stat(sample_max: 200).matrix_stat.my_attack_items  # => [{:tag=>{"name"=>"力戦", "count"=>67}, :appear_ratio=>0.335, :judge_counts=>{"lose"=>16, "win"=>49, "draw"=>2}}, {:tag=>{"name"=>"UFO銀", "count"=>13}, :appear_ratio=>0.065, :judge_counts=>{"win"=>11, "lose"=>2}}, {:tag=>{"name"=>"へなちょこ急戦", "count"=>13}, :appear_ratio=>0.065, :judge_counts=>{"win"=>10, "lose"=>2, "draw"=>1}}, {:tag=>{"name"=>"角交換型", "count"=>10}, :appear_ratio=>0.05, :judge_counts=>{"lose"=>3, "win"=>7}}, {:tag=>{"name"=>"原始棒銀", "count"=>7}, :appear_ratio=>0.035, :judge_counts=>{"win"=>7}}, {:tag=>{"name"=>"▲４五歩早仕掛け", "count"=>6}, :appear_ratio=>0.03, :judge_counts=>{"win"=>6}}, {:tag=>{"name"=>"相掛かり", "count"=>5}, :appear_ratio=>0.025, :judge_counts=>{"lose"=>1, "win"=>4}}, {:tag=>{"name"=>"銀雲雀", "count"=>5}, :appear_ratio=>0.025, :judge_counts=>{"win"=>4, "lose"=>1}}, {:tag=>{"name"=>"手得角交換型", "count"=>5}, :appear_ratio=>0.025, :judge_counts=>{"win"=>4, "lose"=>1}}, {:tag=>{"name"=>"地下鉄飛車", "count"=>4}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>1, "win"=>3}}, {:tag=>{"name"=>"角換わり", "count"=>4}, :appear_ratio=>0.02, :judge_counts=>{"win"=>3, "lose"=>1}}, {:tag=>{"name"=>"棒銀", "count"=>4}, :appear_ratio=>0.02, :judge_counts=>{"win"=>3, "lose"=>1}}, {:tag=>{"name"=>"対振り持久戦", "count"=>3}, :appear_ratio=>0.015, :judge_counts=>{"win"=>3}}, {:tag=>{"name"=>"相掛かり棒銀", "count"=>2}, :appear_ratio=>0.01, :judge_counts=>{"lose"=>1, "win"=>1}}, {:tag=>{"name"=>"右四間飛車", "count"=>2}, :appear_ratio=>0.01, :judge_counts=>{"win"=>2}}, {:tag=>{"name"=>"阿久津流急戦矢倉", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"33金型早繰り銀", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"６筋位取り", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"屋敷流二枚銀", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"△３三角型空中戦法", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"袖飛車", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"相振り飛車", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"横歩取り", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"角換わり腰掛け銀", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}]
# a = [{:tag=>{"name"=>"力戦", "count"=>67}, :appear_ratio=>0.335, :judge_counts=>{"lose"=>16, "win"=>49, "draw"=>2}}, {:tag=>{"name"=>"UFO銀", "count"=>13}, :appear_ratio=>0.065, :judge_counts=>{"win"=>11, "lose"=>2}}, {:tag=>{"name"=>"へなちょこ急戦", "count"=>13}, :appear_ratio=>0.065, :judge_counts=>{"win"=>10, "lose"=>2, "draw"=>1}}, {:tag=>{"name"=>"角交換型", "count"=>10}, :appear_ratio=>0.05, :judge_counts=>{"lose"=>3, "win"=>7}}, {:tag=>{"name"=>"原始棒銀", "count"=>7}, :appear_ratio=>0.035, :judge_counts=>{"win"=>7}}, {:tag=>{"name"=>"▲４五歩早仕掛け", "count"=>6}, :appear_ratio=>0.03, :judge_counts=>{"win"=>6}}, {:tag=>{"name"=>"相掛かり", "count"=>5}, :appear_ratio=>0.025, :judge_counts=>{"lose"=>1, "win"=>4}}, {:tag=>{"name"=>"銀雲雀", "count"=>5}, :appear_ratio=>0.025, :judge_counts=>{"win"=>4, "lose"=>1}}, {:tag=>{"name"=>"手得角交換型", "count"=>5}, :appear_ratio=>0.025, :judge_counts=>{"win"=>4, "lose"=>1}}, {:tag=>{"name"=>"地下鉄飛車", "count"=>4}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>1, "win"=>3}}, {:tag=>{"name"=>"角換わり", "count"=>4}, :appear_ratio=>0.02, :judge_counts=>{"win"=>3, "lose"=>1}}, {:tag=>{"name"=>"棒銀", "count"=>4}, :appear_ratio=>0.02, :judge_counts=>{"win"=>3, "lose"=>1}}, {:tag=>{"name"=>"対振り持久戦", "count"=>3}, :appear_ratio=>0.015, :judge_counts=>{"win"=>3}}, {:tag=>{"name"=>"相掛かり棒銀", "count"=>2}, :appear_ratio=>0.01, :judge_counts=>{"lose"=>1, "win"=>1}}, {:tag=>{"name"=>"右四間飛車", "count"=>2}, :appear_ratio=>0.01, :judge_counts=>{"win"=>2}}, {:tag=>{"name"=>"阿久津流急戦矢倉", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"33金型早繰り銀", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"６筋位取り", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"屋敷流二枚銀", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"△３三角型空中戦法", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"袖飛車", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"相振り飛車", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"横歩取り", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"角換わり腰掛け銀", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}]
# b = [{:tag=>{"name"=>"力戦", "count"=>67}, :appear_ratio=>0.335, :judge_counts=>{"lose"=>16, "win"=>49, "draw"=>2}}, {:tag=>{"name"=>"UFO銀", "count"=>13}, :appear_ratio=>0.065, :judge_counts=>{"win"=>11, "lose"=>2}}, {:tag=>{"name"=>"へなちょこ急戦", "count"=>13}, :appear_ratio=>0.065, :judge_counts=>{"win"=>10, "lose"=>2, "draw"=>1}}, {:tag=>{"name"=>"角交換型", "count"=>10}, :appear_ratio=>0.05, :judge_counts=>{"lose"=>3, "win"=>7}}, {:tag=>{"name"=>"原始棒銀", "count"=>7}, :appear_ratio=>0.035, :judge_counts=>{"win"=>7}}, {:tag=>{"name"=>"▲４五歩早仕掛け", "count"=>6}, :appear_ratio=>0.03, :judge_counts=>{"win"=>6}}, {:tag=>{"name"=>"相掛かり", "count"=>5}, :appear_ratio=>0.025, :judge_counts=>{"lose"=>1, "win"=>4}}, {:tag=>{"name"=>"銀雲雀", "count"=>5}, :appear_ratio=>0.025, :judge_counts=>{"win"=>4, "lose"=>1}}, {:tag=>{"name"=>"手得角交換型", "count"=>5}, :appear_ratio=>0.025, :judge_counts=>{"win"=>4, "lose"=>1}}, {:tag=>{"name"=>"地下鉄飛車", "count"=>4}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>1, "win"=>3}}, {:tag=>{"name"=>"角換わり", "count"=>4}, :appear_ratio=>0.02, :judge_counts=>{"win"=>3, "lose"=>1}}, {:tag=>{"name"=>"棒銀", "count"=>4}, :appear_ratio=>0.02, :judge_counts=>{"win"=>3, "lose"=>1}}, {:tag=>{"name"=>"対振り持久戦", "count"=>3}, :appear_ratio=>0.015, :judge_counts=>{"win"=>3}}, {:tag=>{"name"=>"相掛かり棒銀", "count"=>2}, :appear_ratio=>0.01, :judge_counts=>{"lose"=>1, "win"=>1}}, {:tag=>{"name"=>"右四間飛車", "count"=>2}, :appear_ratio=>0.01, :judge_counts=>{"win"=>2}}, {:tag=>{"name"=>"阿久津流急戦矢倉", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"33金型早繰り銀", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"６筋位取り", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"屋敷流二枚銀", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"△３三角型空中戦法", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"袖飛車", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"相振り飛車", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"横歩取り", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"角換わり腰掛け銀", "count"=>1}, :appear_ratio=>0.005, :judge_counts=>{"win"=>1}}]
# a == b                          # => true

# ActsAsTaggableOn.force_binary_collation = false
# user = User.admin
# user.permit_tag_list.add("☗")
# user.permit_tag_list            # => ["staff", "☗"]
# user.save!
# user.reload
# user.permit_tag_list            # => ["staff", "☗"]

# user = Swars::User["SugarHuuko"]
# tp user.user_stat.matrix_stat.my_attack_items # => [{:tag=>{"name"=>"力戦", "count"=>17}, :appear_ratio=>0.34, :judge_counts=>{"win"=>13, "lose"=>3, "draw"=>1}}, {:tag=>{"name"=>"原始棒銀", "count"=>5}, :appear_ratio=>0.1, :judge_counts=>{"win"=>5}}, {:tag=>{"name"=>"UFO銀", "count"=>5}, :appear_ratio=>0.1, :judge_counts=>{"win"=>5}}, {:tag=>{"name"=>"角交換型", "count"=>3}, :appear_ratio=>0.06, :judge_counts=>{"win"=>3}}, {:tag=>{"name"=>"▲４五歩早仕掛け", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"win"=>2}}, {:tag=>{"name"=>"銀雲雀", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"対振り持久戦", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"相掛かり", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"△３三角型空中戦法", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"角換わり", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"手得角交換型", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"地下鉄飛車", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"へなちょこ急戦", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"draw"=>1}}]
# tp user.user_stat.matrix_stat.vs_attack_items # => [{:tag=>{"name"=>"力戦", "count"=>12}, :appear_ratio=>0.24, :judge_counts=>{"win"=>9, "lose"=>2, "draw"=>1}}, {:tag=>{"name"=>"5筋位取り中飛車", "count"=>5}, :appear_ratio=>0.1, :judge_counts=>{"lose"=>1, "win"=>4}}, {:tag=>{"name"=>"角交換振り飛車", "count"=>5}, :appear_ratio=>0.1, :judge_counts=>{"lose"=>nil, "draw"=>1, "win"=>4}}, {:tag=>{"name"=>"四間飛車", "count"=>4}, :appear_ratio=>0.08, :judge_counts=>{"lose"=>1, "win"=>3}}, {:tag=>{"name"=>"三間飛車", "count"=>4}, :appear_ratio=>0.08, :judge_counts=>{"lose"=>nil, "draw"=>1, "win"=>3}}, {:tag=>{"name"=>"新嬉野流", "count"=>4}, :appear_ratio=>0.08, :judge_counts=>{"lose"=>nil, "win"=>4}}, {:tag=>{"name"=>"棒銀", "count"=>3}, :appear_ratio=>0.06, :judge_counts=>{"lose"=>nil, "win"=>3}}, {:tag=>{"name"=>"向かい飛車", "count"=>3}, :appear_ratio=>0.06, :judge_counts=>{"lose"=>nil, "win"=>3}}, {:tag=>{"name"=>"角交換型", "count"=>3}, :appear_ratio=>0.06, :judge_counts=>{"lose"=>nil, "win"=>3}}, {:tag=>{"name"=>"地下鉄飛車", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"lose"=>nil, "win"=>2}}, {:tag=>{"name"=>"原始棒銀", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"win"=>nil, "lose"=>2}}, {:tag=>{"name"=>"UFO銀", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"win"=>nil, "lose"=>2}}, {:tag=>{"name"=>"右四間飛車", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"win"=>1, "lose"=>1}}, {:tag=>{"name"=>"ゴキゲン中飛車", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"四間飛車ミレニアム", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"相掛かり", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"相掛かり棒銀", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"横歩取り", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"腰掛け銀", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"角換わり", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"手損角交換型", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"鬼殺し向かい飛車", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}]
# tp user.user_stat.matrix_stat.my_defense_items # => [{:tag=>{"name"=>"居玉", "count"=>11}, :appear_ratio=>0.22, :judge_counts=>{"lose"=>2, "win"=>9}}, {:tag=>{"name"=>"舟囲い", "count"=>9}, :appear_ratio=>0.18, :judge_counts=>{"win"=>6, "lose"=>2, "draw"=>1}}, {:tag=>{"name"=>"新型雁木", "count"=>6}, :appear_ratio=>0.12, :judge_counts=>{"win"=>5, "lose"=>1}}, {:tag=>{"name"=>"右玉", "count"=>3}, :appear_ratio=>0.06, :judge_counts=>{"lose"=>1, "win"=>2}}, {:tag=>{"name"=>"居飛車金美濃", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"win"=>2}}, {:tag=>{"name"=>"カブト囲い", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"箱入り娘", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"ツノ銀雁木", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"オールド雁木", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"へこみ矢倉", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"串カツ囲い", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"金盾囲い", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"draw"=>1}}, {:tag=>{"name"=>"三段右玉", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}]
# tp user.user_stat.matrix_stat.vs_defense_items # => [{:tag=>{"name"=>"居玉", "count"=>8}, :appear_ratio=>0.16, :judge_counts=>{"win"=>7, "lose"=>1}}, {:tag=>{"name"=>"高美濃囲い", "count"=>5}, :appear_ratio=>0.1, :judge_counts=>{"lose"=>nil, "win"=>5}}, {:tag=>{"name"=>"中住まい", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"lose"=>nil, "win"=>2}}, {:tag=>{"name"=>"右玉", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"lose"=>nil, "win"=>2}}, {:tag=>{"name"=>"振り飛車ミレニアム", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"片美濃囲い", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"銀冠", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"ツノ銀雁木", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>nil, "lose"=>1}}, {:tag=>{"name"=>"木村美濃", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>nil, "lose"=>1}}, {:tag=>{"name"=>"右矢倉", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"新型雁木", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"カブト囲い", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"振り飛車穴熊", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>nil, "lose"=>1}}, {:tag=>{"name"=>"早囲い", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>nil, "lose"=>1}}, {:tag=>{"name"=>"金矢倉", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"美濃囲い", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}]
# tp user.user_stat.matrix_stat.to_all_chart     # => {:my_attack_items=>[{:tag=>{"name"=>"力戦", "count"=>17}, :appear_ratio=>0.34, :judge_counts=>{"win"=>13, "lose"=>3, "draw"=>1}}, {:tag=>{"name"=>"原始棒銀", "count"=>5}, :appear_ratio=>0.1, :judge_counts=>{"win"=>5}}, {:tag=>{"name"=>"UFO銀", "count"=>5}, :appear_ratio=>0.1, :judge_counts=>{"win"=>5}}, {:tag=>{"name"=>"角交換型", "count"=>3}, :appear_ratio=>0.06, :judge_counts=>{"win"=>3}}, {:tag=>{"name"=>"▲４五歩早仕掛け", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"win"=>2}}, {:tag=>{"name"=>"銀雲雀", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"対振り持久戦", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"相掛かり", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"△３三角型空中戦法", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"角換わり", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"手得角交換型", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"地下鉄飛車", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"へなちょこ急戦", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"draw"=>1}}], :vs_attack_items=>[{:tag=>{"name"=>"力戦", "count"=>12}, :appear_ratio=>0.24, :judge_counts=>{"win"=>9, "lose"=>2, "draw"=>1}}, {:tag=>{"name"=>"5筋位取り中飛車", "count"=>5}, :appear_ratio=>0.1, :judge_counts=>{"lose"=>1, "win"=>4}}, {:tag=>{"name"=>"角交換振り飛車", "count"=>5}, :appear_ratio=>0.1, :judge_counts=>{"lose"=>nil, "draw"=>1, "win"=>4}}, {:tag=>{"name"=>"四間飛車", "count"=>4}, :appear_ratio=>0.08, :judge_counts=>{"lose"=>1, "win"=>3}}, {:tag=>{"name"=>"三間飛車", "count"=>4}, :appear_ratio=>0.08, :judge_counts=>{"lose"=>nil, "draw"=>1, "win"=>3}}, {:tag=>{"name"=>"新嬉野流", "count"=>4}, :appear_ratio=>0.08, :judge_counts=>{"lose"=>nil, "win"=>4}}, {:tag=>{"name"=>"棒銀", "count"=>3}, :appear_ratio=>0.06, :judge_counts=>{"lose"=>nil, "win"=>3}}, {:tag=>{"name"=>"向かい飛車", "count"=>3}, :appear_ratio=>0.06, :judge_counts=>{"lose"=>nil, "win"=>3}}, {:tag=>{"name"=>"角交換型", "count"=>3}, :appear_ratio=>0.06, :judge_counts=>{"lose"=>nil, "win"=>3}}, {:tag=>{"name"=>"地下鉄飛車", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"lose"=>nil, "win"=>2}}, {:tag=>{"name"=>"原始棒銀", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"win"=>nil, "lose"=>2}}, {:tag=>{"name"=>"UFO銀", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"win"=>nil, "lose"=>2}}, {:tag=>{"name"=>"右四間飛車", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"win"=>1, "lose"=>1}}, {:tag=>{"name"=>"ゴキゲン中飛車", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"四間飛車ミレニアム", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"相掛かり", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"相掛かり棒銀", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"横歩取り", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"腰掛け銀", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"角換わり", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"手損角交換型", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"鬼殺し向かい飛車", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}], :my_defense_items=>[{:tag=>{"name"=>"居玉", "count"=>11}, :appear_ratio=>0.22, :judge_counts=>{"lose"=>2, "win"=>9}}, {:tag=>{"name"=>"舟囲い", "count"=>9}, :appear_ratio=>0.18, :judge_counts=>{"win"=>6, "lose"=>2, "draw"=>1}}, {:tag=>{"name"=>"新型雁木", "count"=>6}, :appear_ratio=>0.12, :judge_counts=>{"win"=>5, "lose"=>1}}, {:tag=>{"name"=>"右玉", "count"=>3}, :appear_ratio=>0.06, :judge_counts=>{"lose"=>1, "win"=>2}}, {:tag=>{"name"=>"居飛車金美濃", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"win"=>2}}, {:tag=>{"name"=>"カブト囲い", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"箱入り娘", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"ツノ銀雁木", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"オールド雁木", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"へこみ矢倉", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"串カツ囲い", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"金盾囲い", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"draw"=>1}}, {:tag=>{"name"=>"三段右玉", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}], :vs_defense_items=>[{:tag=>{"name"=>"居玉", "count"=>8}, :appear_ratio=>0.16, :judge_counts=>{"win"=>7, "lose"=>1}}, {:tag=>{"name"=>"高美濃囲い", "count"=>5}, :appear_ratio=>0.1, :judge_counts=>{"lose"=>nil, "win"=>5}}, {:tag=>{"name"=>"中住まい", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"lose"=>nil, "win"=>2}}, {:tag=>{"name"=>"右玉", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"lose"=>nil, "win"=>2}}, {:tag=>{"name"=>"振り飛車ミレニアム", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"片美濃囲い", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"銀冠", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"ツノ銀雁木", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>nil, "lose"=>1}}, {:tag=>{"name"=>"木村美濃", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>nil, "lose"=>1}}, {:tag=>{"name"=>"右矢倉", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"新型雁木", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"カブト囲い", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"振り飛車穴熊", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>nil, "lose"=>1}}, {:tag=>{"name"=>"早囲い", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>nil, "lose"=>1}}, {:tag=>{"name"=>"金矢倉", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}, {:tag=>{"name"=>"美濃囲い", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>nil, "win"=>1}}]}

# sql
# Swars::User["SugarHuuko"].user_stat.matrix_stat.my_attack_items # => [{:tag=>{"name"=>"力戦", "count"=>17}, :appear_ratio=>0.34, :judge_counts=>{"win"=>11, "lose"=>6}}, {:tag=>{"name"=>"へなちょこ急戦", "count"=>4}, :appear_ratio=>0.08, :judge_counts=>{"win"=>3, "lose"=>1}}, {:tag=>{"name"=>"UFO銀", "count"=>3}, :appear_ratio=>0.06, :judge_counts=>{"win"=>3}}, {:tag=>{"name"=>"▲４五歩早仕掛け", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"win"=>2}}, {:tag=>{"name"=>"銀雲雀", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"lose"=>1, "win"=>1}}, {:tag=>{"name"=>"角交換型", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"lose"=>1, "win"=>1}}, {:tag=>{"name"=>"手得角交換型", "count"=>2}, :appear_ratio=>0.04, :judge_counts=>{"win"=>2}}, {:tag=>{"name"=>"角換わり", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"相振り飛車", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"棒銀", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"右四間飛車", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"原始棒銀", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"横歩取り", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"lose"=>1}}, {:tag=>{"name"=>"対振り持久戦", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"角換わり腰掛け銀", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"相掛かり棒銀", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}, {:tag=>{"name"=>"地下鉄飛車", "count"=>1}, :appear_ratio=>0.02, :judge_counts=>{"win"=>1}}]

# s = Swars::User["SugarHuuko"].user_stat.ids_scope
# ActsAsTaggableOn.strict_case_match = true
# c = s.tagged_with("穴熊", on: "attack_tags").s_group_judge_key.count # => {}
# ActsAsTaggableOn.strict_case_match = false
# c = s.tagged_with("穴熊", on: "attack_tags").s_group_judge_key.count # => {}
# Swars::User["SugarHuuko"].user_stat.as_json

# ActiveRecord::Base.logger = ActiveSupport::Logger.new(STDOUT); ActiveSupport::LogSubscriber.colorize_logging = false
# _ { ActsAsTaggableOn.strict_case_match = false; Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tagged_with("居玉", on: "defense_tags").s_group_judge_key.count } # => "233.76 ms"
# _ { ActsAsTaggableOn.strict_case_match = true;  Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tagged_with("居玉", on: "defense_tags").s_group_judge_key.count } # => "1933.83 ms"

# puts Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tagged_with("居玉", on: "defense_tags").explain
# puts Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tagged_with("居玉").explain

# ActsAsTaggableOn.strict_case_match = false; Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tagged_with("居玉", on: "defense_tags").s_group_judge_key.count       # => {"lose"=>5, "win"=>23}
# ActsAsTaggableOn.strict_case_match = true;  Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tagged_with("居玉", on: "defense_tags").s_group_judge_key.count       # => {"lose"=>5, "win"=>23}
# ActsAsTaggableOn.strict_case_match = false; Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tagged_with("居玉").s_group_judge_key.count                           # => {"lose"=>5, "win"=>23}
# ActsAsTaggableOn.strict_case_match = true;  Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tagged_with("居玉").s_group_judge_key.count                           # => {"lose"=>5, "win"=>23}

# ActsAsTaggableOn.force_binary_collation = true;
# _ { Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tag_counts_on("attack_tags", order: "count DESC") } # => "166.47 ms"
# ActsAsTaggableOn.force_binary_collation = false;
# _ { Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tag_counts_on("attack_tags", order: "count DESC") } # => "30.94 ms"
# _ { ActsAsTaggableOn.strict_case_match = true;  Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tag_counts_on("attack_tags", order: "count DESC") } # => "23.10 ms"
# _ { ActsAsTaggableOn.strict_case_match = false; Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tag_counts_on("attack_tags", order: "count DESC") } # => "23.45 ms"

# ActsAsTaggableOn.force_binary_collation = false; Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tagged_with("居玉", on: "defense_tags").s_group_judge_key.count # => {"lose"=>5, "win"=>23}
# ActsAsTaggableOn.force_binary_collation = true;  Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tagged_with("居玉", on: "defense_tags").s_group_judge_key.count # => {"lose"=>5, "win"=>23}
# ActsAsTaggableOn.force_binary_collation = false; Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tagged_with("居玉").s_group_judge_key.count                     # => {"lose"=>5, "win"=>23}
# ActsAsTaggableOn.force_binary_collation = true;  Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tagged_with("居玉").s_group_judge_key.count                     # => {"lose"=>5, "win"=>23}
#
# _ { ActsAsTaggableOn.force_binary_collation = false; Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tagged_with("居玉", on: "defense_tags").s_group_judge_key.count } # => "2621.10 ms"
# _ { ActsAsTaggableOn.force_binary_collation = true;  Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tagged_with("居玉", on: "defense_tags").s_group_judge_key.count } # => "2738.13 ms"
# _ { ActsAsTaggableOn.force_binary_collation = false; Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tagged_with("居玉").s_group_judge_key.count                     }  # => "437.86 ms"
# _ { ActsAsTaggableOn.force_binary_collation = true;  Swars::User["SugarHuuko"].user_stat(sample_max: 200).ids_scope.tagged_with("居玉").s_group_judge_key.count                     } # => "334.31 ms"

# ActsAsTaggableOn::Tag.find_each do |e|
#   if e.name != e.name.toeuc.toutf8
#     p [e.name, e.taggings_count]
#     e.destroy!
#   end
# end

