require "../setup"
_ { Swars::User["SugarHuuko"].user_stat.rarity_stat.to_chart } # => "176.40 ms"
s { Swars::User["SugarHuuko"].user_stat.rarity_stat.to_chart } # => [{:name=>"王道", :value=>21}, {:name=>"準王道", :value=>8}, {:name=>"準変態", :value=>14}, {:name=>"変態", :value=>7}]
Swars::User["SugarHuuko"].user_stat.rarity_stat.send(:tags)  # => [#<ActsAsTaggableOn::Tag id: 201036, name: "力戦", taggings_count: 460465, count: 17>, #<ActsAsTaggableOn::Tag id: 780, name: "銀雲雀", taggings_count: 10480, count: 1>, #<ActsAsTaggableOn::Tag id: 63, name: "対振り持久戦", taggings_count: 128539, count: 1>, #<ActsAsTaggableOn::Tag id: 15, name: "相掛かり", taggings_count: 45768, count: 1>, #<ActsAsTaggableOn::Tag id: 964, name: "▲４五歩早仕掛け", taggings_count: 6924, count: 2>, #<ActsAsTaggableOn::Tag id: 536, name: "△３三角型空中戦法", taggings_count: 6224, count: 1>, #<ActsAsTaggableOn::Tag id: 100, name: "原始棒銀", taggings_count: 95582, count: 5>, #<ActsAsTaggableOn::Tag id: 643, name: "UFO銀", taggings_count: 50096, count: 5>, #<ActsAsTaggableOn::Tag id: 201342, name: "角交換型", taggings_count: 164790, count: 3>, #<ActsAsTaggableOn::Tag id: 834, name: "角換わり", taggings_count: 75639, count: 1>, #<ActsAsTaggableOn::Tag id: 201073, name: "手得角交換型", taggings_count: 199354, count: 1>, #<ActsAsTaggableOn::Tag id: 1540, name: "地下鉄飛車", taggings_count: 11888, count: 1>, #<ActsAsTaggableOn::Tag id: 201080, name: "へなちょこ急戦", taggings_count: 5739, count: 1>, #<ActsAsTaggableOn::Tag id: 117976, name: "カブト囲い", taggings_count: 69013, count: 1>, #<ActsAsTaggableOn::Tag id: 620, name: "箱入り娘", taggings_count: 14231, count: 1>, #<ActsAsTaggableOn::Tag id: 276, name: "舟囲い", taggings_count: 176200, count: 9>, #<ActsAsTaggableOn::Tag id: 201012, name: "居飛車金美濃", taggings_count: 21243, count: 2>, #<ActsAsTaggableOn::Tag id: 201039, name: "新型雁木", taggings_count: 1618, count: 6>, #<ActsAsTaggableOn::Tag id: 120282, name: "居玉", taggings_count: 623947, count: 11>, #<ActsAsTaggableOn::Tag id: 113534, name: "ツノ銀雁木", taggings_count: 33379, count: 1>, #<ActsAsTaggableOn::Tag id: 1747, name: "オールド雁木", taggings_count: 15577, count: 1>, #<ActsAsTaggableOn::Tag id: 201014, name: "へこみ矢倉", taggings_count: 8424, count: 1>, #<ActsAsTaggableOn::Tag id: 895, name: "串カツ囲い", taggings_count: 7207, count: 1>, #<ActsAsTaggableOn::Tag id: 201010, name: "金盾囲い", taggings_count: 20726, count: 1>, #<ActsAsTaggableOn::Tag id: 856, name: "右玉", taggings_count: 20928, count: 3>, #<ActsAsTaggableOn::Tag id: 201021, name: "三段右玉", taggings_count: 1622, count: 1>]
# >>   Swars::User Load (0.1ms)  SELECT `swars_users`.* FROM `swars_users` WHERE `swars_users`.`user_key` = 'SugarHuuko' LIMIT 1
# >>   ↳ app/models/swars/user.rb:5:in `[]'
# >>   Swars::Membership Ids (15.6ms)  SELECT `swars_memberships`.`id` FROM `swars_memberships` INNER JOIN `swars_battles` ON `swars_battles`.`id` = `swars_memberships`.`battle_id` WHERE `swars_memberships`.`user_id` = 17413 ORDER BY `swars_battles`.`battled_at` DESC LIMIT 50
# >>   ↳ app/models/swars/user_stat/base_scope_methods.rb:31:in `scope_ids'
# >>   Swars::Membership Pluck (0.3ms)  SELECT `swars_memberships`.`id` FROM `swars_memberships` WHERE `swars_memberships`.`id` IN (98271894, 98271896, 98271899, 98271900, 98271902, 98271905, 98271907, 98271909, 98271911, 98271913, 98303204, 98212763, 98212766, 98212768, 98212769, 98212771, 98212774, 98208928, 98212775, 98212778, 98263994, 98263995, 98263998, 98264000, 98264001, 98264003, 98264005, 98264007, 98196869, 98196871, 98196872, 98196874, 98196876, 98196878, 98196881, 98196885, 98196899, 98196901, 98196903, 98196909, 98196911, 98196913, 98196915, 98191817, 97909143, 97909144, 97904863, 97904485, 97904487, 97904490)
# >>   ↳ app/models/swars/user_stat/rarity_stat.rb:73:in `block in tags'
# >>   ActsAsTaggableOn::Tag Load (1.2ms)  SELECT tags.*, taggings.tags_count AS count FROM `tags` JOIN (SELECT taggings.tag_id, COUNT(taggings.tag_id) AS tags_count FROM `taggings` WHERE (taggings.taggable_type = 'Swars::Membership' AND taggings.context = 'attack_tags') AND (taggings.taggable_id IN ('97904485','97904487','97904490','97904863','97909143','97909144','98191817','98196869','98196871','98196872','98196874','98196876','98196878','98196881','98196885','98196899','98196901','98196903','98196909','98196911','98196913','98196915','98208928','98212763','98212766','98212768','98212769','98212771','98212774','98212775','98212778','98263994','98263995','98263998','98264000','98264001','98264003','98264005','98264007','98271894','98271896','98271899','98271900','98271902','98271905','98271907','98271909','98271911','98271913','98303204')) GROUP BY `taggings`.`tag_id` HAVING (COUNT(taggings.tag_id) > 0)) AS taggings ON taggings.tag_id = tags.id
# >>   ↳ app/models/swars/user_stat/rarity_stat.rb:72:in `each'
# >>   Swars::Membership Pluck (0.3ms)  SELECT `swars_memberships`.`id` FROM `swars_memberships` WHERE `swars_memberships`.`id` IN (98271894, 98271896, 98271899, 98271900, 98271902, 98271905, 98271907, 98271909, 98271911, 98271913, 98303204, 98212763, 98212766, 98212768, 98212769, 98212771, 98212774, 98208928, 98212775, 98212778, 98263994, 98263995, 98263998, 98264000, 98264001, 98264003, 98264005, 98264007, 98196869, 98196871, 98196872, 98196874, 98196876, 98196878, 98196881, 98196885, 98196899, 98196901, 98196903, 98196909, 98196911, 98196913, 98196915, 98191817, 97909143, 97909144, 97904863, 97904485, 97904487, 97904490)
# >>   ↳ app/models/swars/user_stat/rarity_stat.rb:73:in `block in tags'
# >>   ActsAsTaggableOn::Tag Load (1.0ms)  SELECT tags.*, taggings.tags_count AS count FROM `tags` JOIN (SELECT taggings.tag_id, COUNT(taggings.tag_id) AS tags_count FROM `taggings` WHERE (taggings.taggable_type = 'Swars::Membership' AND taggings.context = 'defense_tags') AND (taggings.taggable_id IN ('97904485','97904487','97904490','97904863','97909143','97909144','98191817','98196869','98196871','98196872','98196874','98196876','98196878','98196881','98196885','98196899','98196901','98196903','98196909','98196911','98196913','98196915','98208928','98212763','98212766','98212768','98212769','98212771','98212774','98212775','98212778','98263994','98263995','98263998','98264000','98264001','98264003','98264005','98264007','98271894','98271896','98271899','98271900','98271902','98271905','98271907','98271909','98271911','98271913','98303204')) GROUP BY `taggings`.`tag_id` HAVING (COUNT(taggings.tag_id) > 0)) AS taggings ON taggings.tag_id = tags.id
# >>   ↳ app/models/swars/user_stat/rarity_stat.rb:72:in `each'
