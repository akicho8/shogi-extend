require "./setup"

# _ { ::Swars::User.where(key: "bsplive") } # => "7.26 ms"
# exit
sql
p QuickScript::Swars::CrossSearchScript.new(x_user_keys: "bsplive", exec: "true").call

# puts QuickScript::Swars::CrossSearchScript.new.empty_message # => nil
# puts QuickScript::Swars::CrossSearchScript.new.empty_message # => nil
# exit

# QuickScript::Swars::CrossSearchScript.new({exec: "true", download_key: "on"}, {current_user: User.admin}).mail_notify
# exit

# tp Swars::Battle.group(:preset).count.keys.collect(&:name)
# QuickScript::Swars::CrossSearchScript.new(x_style_keys: "王道").x_style_infos.collect(&:name) # => ["王道"]
# exit

# ::Swars::Xmode["野良"]          # =>

# QuickScript::Swars::CrossSearchScript.new(x_tag: "居飛車", exec: "true", _method: "get").as_json[:redirect_to][:to] # =>
# _ { QuickScript::Swars::CrossSearchScript.new(x_tag: "居飛車", exec: "true", _method: "get").all_ids } # =>
# _ { QuickScript::Swars::CrossSearchScript.new(x_tag: "居飛車", exec: "true", _method: "get").all_ids } # =>
# sql
# QuickScript::Swars::CrossSearchScript.new(x_tag: "居飛車", x_judge_keys: "勝ち", exec: "true", _method: "get").all_ids.size # =>

# ~> /Users/ikeda/src/shogi-extend/app/models/quick_script/swars/cross_search_script.rb:413:in `block in memberships_scope_by': "SELECT `swars_memberships`.* FROM `swars_memberships` WHERE `swars_memberships`.`battle_id` IN (50130657, 50130658, 50130659, 50130660, 50130661, 50130662, 50130663, 50130664, 50130665, 50130666, 50130667, 50130668, 50130669, 50130670, 50130671, 50130672, 50130673, 50130674, 50130675, 50130676, 50130677, 50130678, 50130679, 50130680, 50130681, 50130682, 50130683, 50130684, 50130685, 50130686, 50130687, 50130688, 50130689, 50130690, 50130691, 50130692, 50130694, 50130695, 50130696, 50130697, 50130698, 50130699, 50130700, 50130701, 50130702, 50130703, 50130704, 50130705, 50130706, 50130707, 50130708, 50130709, 50130710, 50130711, 50130712, 50130713, 50130714, 50130715, 50130716, 50130717, 50130718, 50130719, 50130720, 50130721, 50130722, 50130723, 50130724, 50130725, 50130726, 50130727, 50130728, 50130729, 50130730, 50130731, 50130732, 50130733, 50130734, 50130735, 50130736, 50130737, 50130738, 50130739, 50130740, 50130741, 50130742, 50130743, 50130744, 50130745, 50130746, 50130747, 50130748, 50130749, 50130750, 50130751, 50130752, 50130753, 50130754, 50130755, 50130756, 50130757, 50130758, 50130759, 50130760, 50130761, 50130762, 50130763, 50130764, 50130765, 50130766, 50130767, 50130768, 50130769, 50130770, 50130771, 50130772, 50130773, 50130774, 50130775, 50130776, 50130777, 50130778, 50130779, 50130780, 50130781, 50130782, 50130783, 50130784, 50130785, 50130786, 50130787, 50130788, 50130789, 50130790, 50130791, 50130792, 50130793, 50130794, 50130795, 50130796, 50130797, 50130799, 50130800, 50130801, 50130802, 50130803, 50130804, 50130805, 50130806, 50130807, 50130808, 50130809, 50130810, 50130811, 50130812, 50130813, 50130815, 50130816, 50130817, 50130818, 50130819, 50130820, 50130821, 50130822, 50130823, 50130824, 50130825, 50130826, 50130827, 50130828, 50130829, 50130830, 50130831, 50130832, 50130833, 50130834, 50130835, 50130836, 50130837, 50130838, 50130839, 50130840, 50130841, 50130842, 50130843, 50130844, 50130845, 50130846, 50130847, 50130848, 50130849, 50130850, 50130851, 50130852, 50130853, 50130854, 50130855, 50130856, 50130857, 50130858, 50130859, 50130860, 50130861, 50130862, 50130863, 50130864, 50130865, 50130866, 50130867, 50130868, 50130869, 50130870, 50130871, 50130872, 50130873, 50130874, 50130875, 50130876, 50130877, 50130878, 50130879, 50130880, 50130881, 50130882, 50130883, 50130884, 50130885, 50130886, 50130887, 50130888, 50130889, 50130890, 50130891, 50130892, 50130893, 50130894, 50130895, 50130896, 50130897, 50130898, 50130899, 50130900, 50130901, 50130902, 50130903, 50130904, 50130905, 50130906, 50130907, 50130908, 50130909, 50130910, 50130911, 50130912, 50130913, 50130914, 50130915, 50130916, 50130917, 50130918, 50130919, 50130920, 50130921, 50130922, 50130923, 50130924, 50130925, 50130926, 50130927, 50130928, 50130930, 50130931, 50130932, 50130933, 50130934, 50130935, 50130936, 50130937, 50130938, 50130939, 50130940, 50130941, 50130942, 50130943, 50130944, 50130945, 50130946, 50130947, 50130949, 50130950, 50130951, 50130952, 50130953, 50130954, 50130955, 50130956, 50130957, 50130958, 50130959, 50130960, 50130961, 50130962, 50130963, 50130964, 50130965, 50130966, 50130967, 50130968, 50130969, 50130970, 50130971, 50130972, 50130973, 50130974, 50130975, 50130976, 50130978, 50130979, 50130980, 50130981, 50130982, 50130983, 50130984, 50130986, 50130987, 50130988, 50130989, 50130990, 50130991, 50130992, 50130993, 50130994, 50130995, 50130996, 50130997, 50130998, 50130999, 50131000, 50131001, 50131002, 50131003, 50131004, 50131005, 50131006, 50131007, 50131008, 50131009, 50131010, 50131011, 50131012, 50131013, 50131014, 50131015, 50131016, 50131017, 50131018, 50131019, 50131020, 50131021, 50131022, 50131023, 50131024, 50131025, 50131026, 50131027, 50131028, 50131029, 50131030, 50131031, 50131032, 50131033, 50131034, 50131035, 50131036, 50131037, 50131038, 50131039, 50131040, 50131041, 50131042, 50131043, 50131044, 50131045, 50131046, 50131047, 50131048, 50131049, 50131050, 50131051, 50131052, 50131053, 50131054, 50131055, 50131056, 50131057, 50131058, 50131059, 50131060, 50131061, 50131062, 50131063, 50131064, 50131065, 50131066, 50131067, 50131069, 50131070, 50131071, 50131072, 50131073, 50131074, 50131075, 50131076, 50131077, 50131078, 50131079, 50131080, 50131081, 50131082, 50131083, 50131084, 50131085, 50131086, 50131087, 50131088, 50131089, 50131090, 50131091, 50131092, 50131093, 50131094, 50131095, 50131096, 50131097, 50131098, 50131099, 50131100, 50131101, 50131102, 50131103, 50131104, 50131105, 50131106, 50131107, 50131108, 50131109, 50131110, 50131111, 50131112, 50131113, 50131114, 50131115, 50131116, 50131117, 50131118, 50131119, 50131120, 50131121, 50131122, 50131123, 50131124, 50131125, 50131126, 50131127, 50131128, 50131129, 50131130, 50131131, 50131132, 50131133, 50131134, 50131135, 50131136, 50131137, 50131138, 50131139, 50131140, 50131141, 50131142, 50131143, 50131144, 50131145, 50131146, 50131147, 50131148, 50131149, 50131150, 50131151, 50131152, 50131153, 50131154, 50131155, 50131156, 50131157, 50131158, 50131159, 50131160, 50131161, 50131162, 50131163, 50131164, 50131165, 50131166, 50131167, 50131168, 50131169, 50131170, 50131171, 50131172, 50131173, 50131174, 50131175, 50131176, 50131177, 50131178, 50131179, 50131180, 50131181, 50131182, 50131183, 50131184, 50131185, 50131186, 50131187, 50131188, 50131189, 50131190, 50131191, 50131192, 50131193, 50131194, 50131195, 50131196, 50131197, 50131198, 50131199, 50131200, 50131201, 50131202, 50131203, 50131204, 50131205, 50131207, 50131208, 50131209, 50131210, 50131211, 50131212, 50131213, 50131214, 50131215, 50131216, 50131217, 50131218, 50131219, 50131220, 50131221, 50131222, 50131223, 50131224, 50131225, 50131226, 50131227, 50131228, 50131229, 50131230, 50131231, 50131232, 50131233, 50131234, 50131235, 50131236, 50131237, 50131238, 50131239, 50131240, 50131241, 50131242, 50131243, 50131244, 50131245, 50131246, 50131247, 50131248, 50131249, 50131250, 50131251, 50131252, 50131253, 50131254, 50131255, 50131256, 50131257, 50131258, 50131259, 50131260, 50131261, 50131262, 50131263, 50131264, 50131265, 50131266, 50131267, 50131268, 50131269, 50131270, 50131271, 50131272, 50131273, 50131274, 50131275, 50131276, 50131277, 50131278, 50131279, 50131280, 50131281, 50131282, 50131283, 50131284, 50131285, 50131286, 50131287, 50131288, 50131289, 50131290, 50131292, 50131293, 50131294, 50131295, 50131296, 50131297, 50131298, 50131299, 50131300, 50131301, 50131302, 50131303, 50131304, 50131305, 50131306, 50131307, 50131308, 50131309, 50131310, 50131311, 50131312, 50131313, 50131314, 50131315, 50131316, 50131317, 50131318, 50131319, 50131320, 50131321, 50131323, 50131324, 50131325, 50131326, 50131327, 50131329, 50131330, 50131331, 50131332, 50131333, 50131334, 50131335, 50131336, 50131337, 50131338, 50131339, 50131340, 50131342, 50131343, 50131344, 50131345, 50131346, 50131347, 50131348, 50131349, 50131350, 50131351, 50131352, 50131353, 50131354, 50131355, 50131356, 50131357, 50131358, 50131359, 50131360, 50131361, 50131363, 50131364, 50131365, 50131366, 50131367, 50131368, 50131369, 50131370, 50131371, 50131372, 50131373, 50131374, 50131375, 50131376, 50131377, 50131378, 50131379, 50131380, 50131381, 50131382, 50131383, 50131384, 50131385, 50131386, 50131387, 50131388, 50131389, 50131390, 50131391, 50131392, 50131393, 50131394, 50131395, 50131396, 50131397, 50131398, 50131399, 50131400, 50131401, 50131402, 50131403, 50131404, 50131405, 50131406, 50131407, 50131408, 50131409, 50131410, 50131411, 50131412, 50131414, 50131415, 50131416, 50131417, 50131418, 50131419, 50131420, 50131421, 50131422, 50131424, 50131425, 50131426, 50131427, 50131428, 50131429, 50131430, 50131431, 50131433, 50131434, 50131435, 50131436, 50131437, 50131438, 50131440, 50131441, 50131442, 50131443, 50131444, 50131445, 50131446, 50131447, 50131448, 50131449, 50131450, 50131451, 50131452, 50131453, 50131454, 50131455, 50131456, 50131457, 50131458, 50131459, 50131460, 50131461, 50131462, 50131463, 50131464, 50131465, 50131466, 50131467, 50131468, 50131469, 50131470, 50131471, 50131472, 50131473, 50131474, 50131475, 50131476, 50131477, 50131478, 50131479, 50131480, 50131481, 50131482, 50131483, 50131484, 50131485, 50131486, 50131488, 50131489, 50131490, 50131491, 50131492, 50131493, 50131494, 50131495, 50131496, 50131497, 50131498, 50131499, 50131500, 50131501, 50131502, 50131503, 50131504, 50131506, 50131507, 50131508, 50131509, 50131511, 50131512, 50131513, 50131514, 50131515, 50131516, 50131517, 50131519, 50131520, 50131521, 50131522, 50131523, 50131524, 50131525, 50131526, 50131527, 50131528, 50131529, 50131530, 50131531, 50131532, 50131533, 50131534, 50131535, 50131536, 50131537, 50131538, 50131539, 50131540, 50131541, 50131542, 50131543, 50131544, 50131545, 50131546, 50131547, 50131548, 50131549, 50131550, 50131551, 50131552, 50131553, 50131554, 50131555, 50131556, 50131557, 50131558, 50131559, 50131560, 50131561, 50131562, 50131563, 50131564, 50131565, 50131566, 50131567, 50131568, 50131569, 50131570, 50131571, 50131572, 50131573, 50131574, 50131575, 50131577, 50131578, 50131579, 50131580, 50131581, 50131582, 50131583, 50131584, 50131585, 50131586, 50131587, 50131588, 50131589, 50131590, 50131591, 50131592, 50131593, 50131594, 50131595, 50131596, 50131597, 50131598, 50131599, 50131600, 50131601, 50131602, 50131603, 50131604, 50131605, 50131606, 50131607, 50131608, 50131609, 50131610, 50131611, 50131612, 50131613, 50131614, 50131615, 50131616, 50131617, 50131618, 50131619, 50131620, 50131621, 50131622, 50131623, 50131624, 50131625, 50131626, 50131627, 50131628, 50131629, 50131630, 50131631, 50131632, 50131633, 50131634, 50131635, 50131636, 50131637, 50131638, 50131639, 50131640, 50131641, 50131642, 50131643, 50131644, 50131645, 50131646, 50131647, 50131648, 50131649, 50131650, 50131651, 50131652, 50131653, 50131654, 50131655, 50131656, 50131657, 50131658, 50131659, 50131660, 50131661, 50131662, 50131663, 50131664, 50131666, 50131667, 50131668, 50131669, 50131670, 50131671, 50131672, 50131673, 50131674, 50131675, 50132279, 50132280, 50132281, 50132282, 50132283) AND `swars_memberships`.`user_id` IN (SELECT `swars_users`.`id` FROM `swars_users` WHERE `swars_users`.`user_key` = 'bsplive')" (RuntimeError)
# ~> 	from <internal:kernel>:124:in `then'
# ~> 	from /Users/ikeda/src/shogi-extend/app/models/quick_script/swars/cross_search_script.rb:398:in `memberships_scope_by'
# ~> 	from /Users/ikeda/src/shogi-extend/app/models/quick_script/swars/cross_search_script.rb:363:in `sub_scope'
# ~> 	from /Users/ikeda/src/shogi-extend/app/models/quick_script/swars/cross_search_script.rb:349:in `block (2 levels) in found_ids'
# ~> 	from /opt/rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/activerecord-7.1.3.4/lib/active_record/relation/batches.rb:396:in `block in batch_on_unloaded_relation'
# ~> 	from /opt/rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/activerecord-7.1.3.4/lib/active_record/relation/batches.rb:372:in `loop'
# ~> 	from /opt/rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/activerecord-7.1.3.4/lib/active_record/relation/batches.rb:372:in `batch_on_unloaded_relation'
# ~> 	from /opt/rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/activerecord-7.1.3.4/lib/active_record/relation/batches.rb:269:in `in_batches'
# ~> 	from /Users/ikeda/src/shogi-extend/app/models/quick_script/swars/cross_search_script.rb:345:in `with_index'
# ~> 	from /Users/ikeda/src/shogi-extend/app/models/quick_script/swars/cross_search_script.rb:345:in `block in found_ids'
# ~> 	from <internal:kernel>:148:in `yield_self'
# ~> 	from /Users/ikeda/src/shogi-extend/app/models/quick_script/swars/cross_search_script.rb:343:in `found_ids'
# ~> 	from /Users/ikeda/src/shogi-extend/app/models/quick_script/swars/cross_search_script.rb:336:in `block in first_heavy_process_execute'
# ~> 	from /opt/rbenv/versions/3.2.2/lib/ruby/3.2.0/benchmark.rb:311:in `realtime'
# ~> 	from /Users/ikeda/src/shogi-extend/app/models/quick_script/swars/cross_search_script.rb:336:in `first_heavy_process_execute'
# ~> 	from /Users/ikeda/src/shogi-extend/app/models/quick_script/swars/cross_search_script.rb:239:in `call'
# ~> 	from -:6:in `<main>'
# >>   Swars::User Exists? (0.6ms)  SELECT 1 AS one FROM `swars_users` WHERE `swars_users`.`user_key` = 'bsplive' LIMIT 1
# >>   ↳ app/models/quick_script/swars/cross_search_script.rb:273:in `block in validate!'
# >>   Swars::Battle Ids (2.1ms)  SELECT `swars_battles`.`id` FROM `swars_battles` ORDER BY `swars_battles`.`id` DESC LIMIT 1000
# >>   ↳ app/models/quick_script/swars/cross_search_script.rb:345:in `with_index'
# >>   Swars::Battle Ids (2.1ms)  SELECT `swars_battles`.`id` FROM `swars_battles` WHERE `swars_battles`.`id` >= 50130657
# >>   ↳ app/models/quick_script/swars/cross_search_script.rb:361:in `sub_scope'
