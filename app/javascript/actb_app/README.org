* 構造

index (+ store)
  + room_message
  + header
  + lobby
  + matching (include matching_interval)
  + battle
  + result
  + builder (かなり疎結合)

・support はすべてに mixin
・builder だけは完全分離で他は分離できないので基本indexにすべてのメソッドがある
・ライブラリではないので $paret をむしろ積極的に使っていく

* 重要

・Vuex を使うな
・どうしてもグローバル変数にしないといけなくなったときでも Vuex を使うな
・死んでも Vuex を使うな

* rule_key
|-----------+--------------|
| marathon_rule | マラソン     |
| singleton_rule | シングルトン |
|-----------+--------------|

* sub_mode
|----------------+------------------------|
| standby        | 最初                   |
| readygo_wait   | 開始前の待ち時間       |
| deden_mode     | 問題番号表示           |
| operation_mode | ユーザー考え中・操作中 |
|----------------+------------------------|

* sub_mode が operation_mode のときの x_mode (singleton_rule 専用)
|---------+--------------|
| x1_idol | 見ている     |
| x2_play | 操作中       |
| x3_see  | 相手が操作中 |
|---------+--------------|

* チャンネル
|--------+--------------------------------+--------------------+-----------|
| name   |                                | 接続               | スコープ  |
|--------+--------------------------------+--------------------+-----------|
| School | 接続中の人数などを配信する     | 常時               | 全体      |
| Lobby  | マッチングしたら部屋を配信する |                    | 全体      |
| Room   | 対戦するための部屋             | 対戦中のみ常時     | room_id   |
| Battle | 対戦時                         | バトル毎に作り直す | battle_id |
|--------+--------------------------------+--------------------+-----------|

* 対戦までの流れ

|--------+--------------------+--------------------------------+---------------+--------------+----------------|
| 配信元 |                    |                                |               | 購読中       |                |
|--------+--------------------+--------------------------------+---------------+--------------+----------------|
|        | matching_search    | マッチング中                   |               |              |                |
| Lobby  | room_broadcasted   | 成立したので部屋を配信         |               | Lobby        |                |
|        | -> room_setup      | 部屋(ID)で購読する             | Lobby購読停止 | Room         | チャット初期化 |
| Room   | battle_broadcasted | するとバトル(ID)が送られてくる |               | Room,        |                |
|        | -> battle_setup    | そのバトル(ID)でバトルを購読   |               | Room, Battle |                |
|--------+--------------------+--------------------------------+---------------+--------------+----------------|


