require File.expand_path('../../../config/environment', __FILE__)
ShareBoard.setup(force: true)

Judge.count                     # => 3
Location.count                  # => 2

room = ShareBoard::Room.create!
room.battles.create! do |e|
  e.memberships.build([
      { user_name: "alice", location_key: "black", judge_key: "win",  },
      { user_name: "bob",   location_key: "white", judge_key: "lose", },
      { user_name: "carol", location_key: "black", judge_key: "win",  },
    ])
end

room # => #<ShareBoard::Room id: 7, key: "dev_room", battles_count: 1, created_at: "2023-04-04 20:17:29.000000000 +0900", updated_at: "2023-04-04 20:17:29.000000000 +0900">
room.battles_count              # => 1
room.memberships.count          # => 3
room.users.count                # => 3
battle = room.battles.first
tp ShareBoard::Roomship
tp battle
tp battle.users
tp battle.memberships

# >> |----+---------+---------+-----------+------------+---------------+----------+-------+------+---------------------------+---------------------------|
# >> | id | room_id | user_id | win_count | lose_count | battles_count | win_rate | score | rank | created_at                | updated_at                |
# >> |----+---------+---------+-----------+------------+---------------+----------+-------+------+---------------------------+---------------------------|
# >> | 19 |       7 |      19 |         1 |          0 |             1 |      1.0 |     1 |   -1 | 2023-04-04 20:17:29 +0900 | 2023-04-04 20:17:29 +0900 |
# >> | 20 |       7 |      20 |         0 |          1 |             1 |      0.0 |     0 |   -1 | 2023-04-04 20:17:29 +0900 | 2023-04-04 20:17:29 +0900 |
# >> | 21 |       7 |      21 |         1 |          0 |             1 |      1.0 |     1 |   -1 | 2023-04-04 20:17:29 +0900 | 2023-04-04 20:17:29 +0900 |
# >> |----+---------+---------+-----------+------------+---------------+----------+-------+------+---------------------------+---------------------------|
# >> |-----------------+----------------------------------------------------------------------------------------------------------|
# >> |              id | 7                                                                                                        |
# >> |         room_id | 7                                                                                                        |
# >> |             key | aaa2ac68f9ce843afb2ee49f84ee335a                                                                         |
# >> |           title |                                                                                                          |
# >> |            sfen | position sfen lnsgkgsnl/1r5b1/ppppppppp/9/9/9/PPPPPPPPP/1B5R1/LNSGKGSNL b - 1 moves 7g7f 3c3d 8h2b+ 3a2b |
# >> |            turn | 4                                                                                                        |
# >> | win_location_id | 1                                                                                                        |
# >> |        position | 0                                                                                                        |
# >> |      created_at | 2023-04-04 20:17:29 +0900                                                                                |
# >> |      updated_at | 2023-04-04 20:17:29 +0900                                                                                |
# >> |-----------------+----------------------------------------------------------------------------------------------------------|
# >> |----+-------+-------------------+---------------------------+---------------------------|
# >> | id | name  | memberships_count | created_at                | updated_at                |
# >> |----+-------+-------------------+---------------------------+---------------------------|
# >> | 19 | alice |                 1 | 2023-04-04 20:17:29 +0900 | 2023-04-04 20:17:29 +0900 |
# >> | 20 | bob   |                 1 | 2023-04-04 20:17:29 +0900 | 2023-04-04 20:17:29 +0900 |
# >> | 21 | carol |                 1 | 2023-04-04 20:17:29 +0900 | 2023-04-04 20:17:29 +0900 |
# >> |----+-------+-------------------+---------------------------+---------------------------|
# >> |----+-----------+---------+----------+-------------+----------+---------------------------+---------------------------|
# >> | id | battle_id | user_id | judge_id | location_id | position | created_at                | updated_at                |
# >> |----+-----------+---------+----------+-------------+----------+---------------------------+---------------------------|
# >> | 19 |         7 |      19 |        1 |           1 |        0 | 2023-04-04 20:17:29 +0900 | 2023-04-04 20:17:29 +0900 |
# >> | 20 |         7 |      20 |        2 |           2 |        1 | 2023-04-04 20:17:29 +0900 | 2023-04-04 20:17:29 +0900 |
# >> | 21 |         7 |      21 |        1 |           1 |        2 | 2023-04-04 20:17:29 +0900 | 2023-04-04 20:17:29 +0900 |
# >> |----+-----------+---------+----------+-------------+----------+---------------------------+---------------------------|
